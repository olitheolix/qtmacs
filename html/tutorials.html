


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Programming Qtmacs &mdash; Qtmacs 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="_static/cloud.js"></script>
    <link rel="top" title="Qtmacs 0.1 documentation" href="index.html" />
    <link rel="next" title="Developers" href="developers.html" />
    <link rel="prev" title="Applets" href="applets.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="developers.html" title="Developers"
             accesskey="N">next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="applets.html" title="Applets"
             accesskey="P">previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">Qtmacs 0.1 documentation</a> &raquo;</li>
 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="programming-qtmacs">
<span id="tutorials"></span><h1>Programming Qtmacs<a class="headerlink" href="#programming-qtmacs" title="Permalink to this headline">¶</a></h1>
<p>A learning-by-doing introduction to programming Qtmacs applets and
macros. This tutorial assumes basic knowledge of Python3 and PyQt4.</p>
<p>Qtmacs consists of applets and macros. The former groups arbitrary
widgets together to solve a particular task (eg. display text, run a
shell, browse a PDF file), and the latter interact with them on
behalf of the user.</p>
<p>Creating Qtmacs applets is hardly different from creating any other PyQt
program: place widgets, connect slots, and implement callback
functions. In Qtmacs, however, the individual widgets can be
(optionally) stripped off their keyboard events. The result is that
their respective <tt class="docutils literal"><span class="pre">keypressed</span></tt> and <tt class="docutils literal"><span class="pre">keyPressedEvent</span></tt> methods will not
be called because Qtmacs receives the events instead. To engage with the
widgets again requires to write macros and, optionally, bind them to
shortcuts.</p>
<p>This concept may seem &#8211; in fact is &#8211; impractical for something as
simple as inserting a character into a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a>. However, it is also
the cornerstone that allows to customise the widget interactions freely
without modifying their source code.</p>
<div class="section" id="hello-world">
<h2>Hello World<a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h2>
<p>This quick-start tutorial explains the basic mechanics behind macros and
applets. To write a macro the programmer must subclass <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_macro.QtmacsMacro" title="qtmacs.base_macro.QtmacsMacro"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMacro</span></tt></a>
and reimplement the <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_macro.QtmacsMacro.qteRun" title="qtmacs.base_macro.QtmacsMacro.qteRun"><tt class="xref py py-mod docutils literal"><span class="pre">qteRun</span></tt></a> method, whereas applets must subclass
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet" title="qtmacs.base_applet.QtmacsApplet"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsApplet</span></tt></a> and may treat it like a normal <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qkeyevent.html">QWidget</a> ie. add widgets
and callback functions. Furthermore, both must be registered with Qtmacs
before they can be used.</p>
<div class="section" id="macros">
<span id="id1"></span><h3>Macros<a class="headerlink" href="#macros" title="Permalink to this headline">¶</a></h3>
<p>Create a file called <tt class="docutils literal"><span class="pre">tut_1.py</span></tt> and populate it with the following
content.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 1: a &quot;Hello world&quot; macro.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">HelloWorld</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints &#39;Hello world.&#39; to the console.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Hello world.&#39;</span><span class="p">)</span>


<span class="c"># Register the macro with Qtmacs.</span>
<span class="n">macro_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Line 6 imports the <tt class="docutils literal"><span class="pre">qtmacs.qte_global</span></tt> module which is the agreed upon
place for global variables. Among other variables, it always contains
<tt class="docutils literal"><span class="pre">qteMain</span></tt>, which is a reference to the <em>one and only</em> instance of
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain" title="qtmacs.qtmacsmain.QtmacsMain"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMain</span></tt></a>. This instance is the engine behind all of Qtmacs and
responsible for managing the layout, instantiating applets, spawn
windows, execute macros...</p>
<p>Line 7 imports the base class for all macros (<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_macro.QtmacsMacro" title="qtmacs.base_macro.QtmacsMacro"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMacro</span></tt></a>) and
Line 10 is for convenience only.</p>
<p>The constructor of every macro must list the compatible applet- and
widget signatures (see <a class="reference internal" href="#signatures"><em>Signatures</em></a> for more details), which is
what Lines 24-25 are all about (they effectively ensure that our
&#8220;HelloWorld&#8221; macro will execute no matter what applet and widget is
currently active).</p>
<p>As mentioned in the introduction already, the macro functionality goes
into the <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_macro.QtmacsMacro.qteRun" title="qtmacs.base_macro.QtmacsMacro.qteRun"><tt class="xref py py-mod docutils literal"><span class="pre">qteRun</span></tt></a> method &#8211; a simple <tt class="docutils literal"><span class="pre">print</span></tt> statement in our case.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the constructor and <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_macro.QtmacsMacro.qteRun" title="qtmacs.base_macro.QtmacsMacro.qteRun"><tt class="xref py py-mod docutils literal"><span class="pre">qteRun</span></tt></a> methods of <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_macro.QtmacsMacro" title="qtmacs.base_macro.QtmacsMacro"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMacro</span></tt></a> are
the only methods in <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_macro.QtmacsMacro" title="qtmacs.base_macro.QtmacsMacro"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMacro</span></tt></a> that should be overloaded;
everything else spells trouble unless you know what you are doing.</p>
</div>
<p>Line 32 uses <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteRegisterMacro" title="qtmacs.qtmacsmain.QtmacsMain.qteRegisterMacro"><tt class="xref py py-mod docutils literal"><span class="pre">qteRegisterMacro</span></tt></a> to register the macro with Qtmacs. The
actual name under which it will be known is either specified explicitly
or, as in our case, implicitly name mangled based on the class name. The
name mangling turns camel bump words into hyphenated lower case words
which means that our <tt class="docutils literal"><span class="pre">HelloWorld</span></tt> class will become known as the
<tt class="docutils literal"><span class="pre">hello-world</span></tt> macro. To double check, <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteRegisterMacro" title="qtmacs.qtmacsmain.QtmacsMain.qteRegisterMacro"><tt class="xref py py-mod docutils literal"><span class="pre">qteRegisterMacro</span></tt></a> will return
the name as well.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p><a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteRegisterMacro" title="qtmacs.qtmacsmain.QtmacsMain.qteRegisterMacro"><tt class="xref py py-mod docutils literal"><span class="pre">qteRegisterMacro</span></tt></a> expects a class, <strong>not</strong> an instance
of a class. In the above example, the statement:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">macro_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">())</span>
</pre></div>
</div>
<p>would raise an error. The correct version is:</p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">macro_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To try out the macro, invoke Qtmacs from the console with</p>
<div class="highlight-bash"><div class="highlight"><pre>./qtmacs.py --load tut_1.py
</pre></div>
</div>
<p>press <tt class="docutils literal"><span class="pre">&lt;alt&gt;+x</span></tt>, enter <tt class="docutils literal"><span class="pre">hello-world</span></tt> (you may use <tt class="docutils literal"><span class="pre">&lt;tab&gt;</span></tt>
completion) and see the <cite>Hello world</cite> string appear in the console
window.</p>
<p>The remainder of this section will add two more features, namely
display the <tt class="docutils literal"><span class="pre">hello-world</span></tt> message in the status bar and associate
a keyboard shortcut with it. These two modifications are reflected
in the code below:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 1: a &quot;Hello world&quot; macro.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">HelloWorld</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays &#39;Hello world.&#39; in the status applet.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteStatus</span><span class="p">(</span><span class="s">&#39;Hello world.&#39;</span><span class="p">)</span>
</span>

<span class="c"># Register the macro with Qtmacs.</span>
<span class="n">macro_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">)</span>
<span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+d h&#39;</span><span class="p">,</span> <span class="n">macro_name</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>The only two modifications are Line 28, which uses the <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteStatus" title="qtmacs.qtmacsmain.QtmacsMain.qteStatus"><tt class="xref py py-mod docutils literal"><span class="pre">qteStatus</span></tt></a>
method of the Qtmacs engine, and Line 33, which calls
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyGlobal</span></tt></a> to assign the macro a keyboard
shortcut.</p>
<p>The format of key-sequences supplied to <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyGlobal</span></tt></a> should be
self explanatory: each sequence consists of an optional modifier
(<tt class="docutils literal"><span class="pre">&lt;alt&gt;+</span></tt> or <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+</span></tt>) in conjunction with a character. Arbitrarily
many of these combinations can be chained together but must be separated
by white-space. To bind the white-space character itself use
<tt class="docutils literal"><span class="pre">&lt;space&gt;</span></tt>. Here are some example arguments for <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyGlobal</span></tt></a>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="s">&#39;f&#39;</span>
<span class="s">&#39;F&#39;</span>
<span class="s">&#39;&lt;ctrl&gt;+f&#39;</span>
<span class="s">&#39;&lt;ctrl&gt;+f h &lt;alt&gt;+K &lt;ctrl&gt;+k&#39;</span>
<span class="s">&#39;&lt;ctrl&gt;++ &lt;ctrl&gt;+&lt;alt&gt;++ &lt;ctrl&gt;+&lt;alt&gt;+&lt;space&gt;&#39;</span>
<span class="s">&#39;&lt;ctrl&gt;+f &lt;ctrl&gt;+F &lt;ctrl&gt;++ &lt;ctrl&gt;+&lt;space&gt; &lt;ctrl&gt;+&lt; &lt;alt&gt;+&gt; &lt; &gt; &lt;space&gt;&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Every macro has the <tt class="docutils literal"><span class="pre">self.qteMain</span></tt> attribute for convenience,
and it is always identical to <tt class="docutils literal"><span class="pre">qtmacs.qte_global.qteMain</span></tt>.</p>
</div>
<p>Restarting Qtmacs once more with</p>
<div class="highlight-bash"><div class="highlight"><pre>./qtmacs.py --load tut_1.py
</pre></div>
</div>
<p>allows us to conveniently invoke the <tt class="docutils literal"><span class="pre">hello-world</span></tt> with the
keyboard shortcut <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+d</span> <span class="pre">h</span></tt>, although the manual way via
<tt class="docutils literal"><span class="pre">&lt;alt&gt;+x</span></tt> will still work. Furthermore, the <cite>Hello world</cite> message will
now appear in the status bar at the bottom of the screen:</p>
<div class="figure align-center">
<img alt="_images/tut_1_2.png" src="_images/tut_1_2.png" style="width: 700px;" />
<p class="caption">A &#8220;Hello world&#8221; message in the status bar.</p>
</div>
</div>
<div class="section" id="applets">
<span id="appletdev"></span><h3>Applets<a class="headerlink" href="#applets" title="Permalink to this headline">¶</a></h3>
<p>Applets must inherit from <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet" title="qtmacs.base_applet.QtmacsApplet"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsApplet</span></tt></a> and may contain arbitrary Qt
widgets as it is itself derived from <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qkeyevent.html">QWidget</a>. To program an
empty applet put the following code into a file and start Qtmacs as in
the previous section:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 1: a &quot;Hello world&quot; applet.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="hll"><span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
</span>
<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="hll"><span class="k">class</span> <span class="nc">HelloWorldApp</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    An empty applet.</span>
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">pass</span>
</span>

<span class="c"># Register the applet with Qtmacs.</span>
<span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">HelloWorldApp</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>Line 7 imports the <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet" title="qtmacs.base_applet.QtmacsApplet"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsApplet</span></tt></a> class, Lines 13-17 define the empty
applet, and Line 21 uses <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteRegisterApplet" title="qtmacs.qtmacsmain.QtmacsMain.qteRegisterApplet"><tt class="xref py py-mod docutils literal"><span class="pre">qteRegisterApplet</span></tt></a> to make it known to Qtmacs.</p>
<p>Internally, Qtmacs will identify applets via their class names, which
means that our applet will be called <tt class="docutils literal"><span class="pre">HelloWorldApplet</span></tt> (no name
mangling occurs like for macros).</p>
<p>To instantiate this applet run the command <cite>new-applet</cite>, either by
pressing <tt class="docutils literal"><span class="pre">&lt;alt&gt;+x</span></tt> to open the macro query, typing <tt class="docutils literal"><span class="pre">new-applet</span></tt>, and
then entering <tt class="docutils literal"><span class="pre">HelloWorldApplet</span></tt>, or skipping the first part by typing
<tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span> <span class="pre">&lt;ctrl&gt;+a</span></tt> and then typing the applet name. Either way, you
should be presented with an empty applet like this:</p>
<div class="figure align-center">
<img alt="_images/tut_1_3.png" src="_images/tut_1_3.png" style="width: 700px;" />
<p class="caption">An empty applet.</p>
</div>
<p>The next step is to populate the applet with Qt widgets, for instance a
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlabel.html">QLabel</a> to display the <cite>Hello world</cite> message. This only requires
a constructor to instantiate and place the widget, just like in any
other PyQt program:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 1: a &quot;Hello world&quot; applet.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">HelloWorldApp</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &#39;Hello world&#39; applet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
</span><span class="hll">        <span class="c"># Initialise the base class.</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="c"># Instantiate a QLabel.</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteLabel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s">&#39;Hello world.&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span>

<span class="c"># Register the applet with Qtmacs.</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">HelloWorldApp</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>This will change the appearance of the applet to:</p>
<div class="figure align-center">
<img alt="_images/tut_1_4.png" src="_images/tut_1_4.png" style="width: 700px;" />
<p class="caption">An applet with a QLabel spelling &#8220;Hello world&#8221;.</p>
</div>
<p>Other widgets, including layouts, can be added likewise:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 1: a &quot;Hello world&quot; macro and applet.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">HelloWorld</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays &#39;Hello world.&#39; in the status applet.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteStatus</span><span class="p">(</span><span class="s">&#39;Hello world.&#39;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="o">.</span><span class="n">_qteActiveWidget</span><span class="p">)</span>


<span class="c"># Register the macro with Qtmacs.</span>
<span class="n">macro_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">HelloWorld</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+d h&#39;</span><span class="p">,</span> <span class="n">macro_name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">HelloWorldApp</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A &#39;Hello world&#39; applet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Create some Qt widgets for demonstration purposes.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLabel</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s">&#39;Hello world.&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteTextEdit</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="s">&#39;TextEdit&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSpinBox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSpinBox</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSlider</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QSlider</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteDial</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QDial</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="c"># Place the widgets in a layout.</span>
</span><span class="hll">        <span class="n">layout</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">()</span>
</span><span class="hll">        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteLabel</span><span class="p">)</span>
</span><span class="hll">        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteTextEdit</span><span class="p">)</span>
</span><span class="hll">        <span class="n">layout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteSpinBox</span><span class="p">)</span>
</span><span class="hll">        <span class="n">layout_tmp</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">()</span>
</span><span class="hll">        <span class="n">layout_tmp</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteSlider</span><span class="p">)</span>
</span><span class="hll">        <span class="n">layout_tmp</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteDial</span><span class="p">)</span>
</span><span class="hll">        <span class="n">layout</span><span class="o">.</span><span class="n">addLayout</span><span class="p">(</span><span class="n">layout_tmp</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
</span>

<span class="c"># Register the applet with Qtmacs, create an instance of it, and display it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">HelloWorldApp</span><span class="p">)</span>
<span class="hll"><span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
</span><span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>Aside from the additional widget, only the Lines 68-69
are new. Their purpose is to instantiate and activate the applet
immediately so that it becomes visible at startup immediately.</p>
<div class="figure align-center">
<img alt="_images/tut_1_5.png" src="_images/tut_1_5.png" style="width: 700px;" />
<p class="caption">An applet can contain arbitrary widgets from the Qt library.</p>
</div>
<p>The <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet" title="qtmacs.base_applet.QtmacsApplet"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsApplet</span></tt></a> can now be augmented with other widgets and
callback routines to make them useful.</p>
<p>This completes the Hello World tutorial. It showed how to write applet-
and macros but did not elaborate on how to connect macros with
widgets. Currently, all widgets (eg. the <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a>) react to
keyboard input as usual although, behind the scenes, Qtmacs intercepts
and parses all their input for macro shortcuts before propagating the
key to the widget.</p>
<p>The <a class="reference internal" href="#simpleeditor"><em>next section</em></a> will explain how to turn off the
native behaviour of the widget so that it can be arbitrarily programmed
with macros.</p>
<div class="section" id="remarks">
<h4>Remarks<a class="headerlink" href="#remarks" title="Permalink to this headline">¶</a></h4>
<p><a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet" title="qtmacs.base_applet.QtmacsApplet"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsApplet</span></tt></a> inherits from <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qkeyevent.html">QWidget</a> and may therefore contain any
number of Qt widgets and layouts. However, as mentioned above, all keys
are parsed by Qtmacs first and will only passed on to the respective
widget if no macro was associated with that key. For instance, if a
global macro were bound to the <tt class="docutils literal"><span class="pre">h</span></tt> key then it would not be possible
anymore to enter the character <tt class="docutils literal"><span class="pre">h</span></tt> into a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> or
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a>.</p>
<p>Another noteworthy point is that the <tt class="docutils literal"><span class="pre">show()</span></tt> and <tt class="docutils literal"><span class="pre">hide()</span></tt> methods
of applets are inactive. To implement these effects the programmer
must resort to <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteMakeAppletActive" title="qtmacs.qtmacsmain.QtmacsMain.qteMakeAppletActive"><tt class="xref py py-mod docutils literal"><span class="pre">qteMakeAppletActive</span></tt></a> or <tt class="xref py py-mod docutils literal"><span class="pre">qteReplaceWindowInLayout</span></tt>
since eg. showing an applet implies that another applet must be hidden
or the layout be split. In either case, Qtmacs needs to do some
housekeeping which is encapsulated in the aforementioned methods
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteMakeAppletActive" title="qtmacs.qtmacsmain.QtmacsMain.qteMakeAppletActive"><tt class="xref py py-mod docutils literal"><span class="pre">qteMakeAppletActive</span></tt></a> and <tt class="xref py py-mod docutils literal"><span class="pre">qteReplaceWindowInLayout</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">show()</span></tt> and <tt class="docutils literal"><span class="pre">hide()</span></tt> methods of widgets <em>inside</em>
applets can be used as usual. Just the <tt class="docutils literal"><span class="pre">show()</span></tt> and
<tt class="docutils literal"><span class="pre">hide()</span></tt> method of the applet itself (ie. instances of
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet" title="qtmacs.base_applet.QtmacsApplet"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsApplet</span></tt></a>) can not.</p>
</div>
</div>
</div>
</div>
<div class="section" id="a-text-editor-qtmacs-style">
<span id="simpleeditor"></span><h2>A Text Editor &#8211; Qtmacs Style<a class="headerlink" href="#a-text-editor-qtmacs-style" title="Permalink to this headline">¶</a></h2>
<p>This tutorial will implement a macro driven text editor based on a
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a>. The applet code is not principally different from that of
the previous section except that the widget will be stripped off its
keyboard events with the help of <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet.qteAddWidget" title="qtmacs.base_applet.QtmacsApplet.qteAddWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteAddWidget</span></tt></a>. From then on, the
only way to insert- and delete characters from or move the cursor, is via
macros that program the widget directly.</p>
<p>The goal in this tutorial is not to create a full fledged editor but to
show the principle. To start, create a new file <cite>tut_2.py</cite> and populate
it with the following applet code:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 2: an editor component -- Qtmacs style.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialTextEdit</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple text editor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QTextEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTextEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Tutorial 2: a macro driven text editor.&#39;</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs, create an instance of it, and</span>
<span class="c"># display it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialTextEdit</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Note how this code is almost identical to <cite>tut_1.py</cite> from the previous
tutorial except that the <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlabel.html">QLabel</a> was replaced by a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> and
that <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet.qteAddWidget" title="qtmacs.base_applet.QtmacsApplet.qteAddWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteAddWidget</span></tt></a> is called on it. The <tt class="docutils literal"><span class="pre">autoBind=False</span></tt> option is
merely to prevent Qtmacs from automatically installing standard macros
which would forfeit the purpose of this tutorial, but is very convenient
otherwise to avoid macro duplication.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">the widgets for which default key bindings are installed are
specified in <tt class="docutils literal"><span class="pre">qte_global.default_widget_keybindings</span></tt>.</p>
</div>
<p>After invoking Qtmacs from the shell like so</p>
<div class="highlight-bash"><div class="highlight"><pre>./qtmacs.py --load tut_2.py
</pre></div>
</div>
<p>the following screen will (hopefully) appear:</p>
<div class="figure align-center">
<img alt="_images/tut_2_1.png" src="_images/tut_2_1.png" style="width: 700px;" />
<p class="caption">An applet with a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> component.</p>
</div>
<p>If you try to type any text you will notice that the <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> is
unresponsive. The reason is that <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet.qteAddWidget" title="qtmacs.base_applet.QtmacsApplet.qteAddWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteAddWidget</span></tt></a> told Qtmacs not to
deliver any keyboard events to the widget anymore. Qtmacs will
nonetheless parse all incoming keys for macro shortcuts, but since none
have been defined yet, no macros are executed. This can also be seen in
the LogViewer applet (press <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+n</span></tt> until you see it).</p>
<div class="figure align-center">
<img alt="_images/tut_2_1a.png" src="_images/tut_2_1a.png" style="width: 700px;" />
<p class="caption">The LogViewer applet reports unknown key-sequences.</p>
</div>
<p>The only way to interact with the <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a>, and any other widget in
Qtmacs registered via <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet.qteAddWidget" title="qtmacs.base_applet.QtmacsApplet.qteAddWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteAddWidget</span></tt></a>, is via macros &#8211; the core
philosophy of Qtmacs. So, let us write one.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Only keyboard events are blocked. Mouse events are delivered
as usual.</p>
</div>
<p>The first macro will allow us to type the character <tt class="docutils literal"><span class="pre">e</span></tt>. The excellent
Qt documentation for <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> reveals that
<a class="reference external" href="textCursor.insertText">textCursor().insertText(&#8216;e&#8217;)</a> will do the
trick, and the macro to inserts the character <tt class="docutils literal"><span class="pre">e</span></tt> may therefore look
like this:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 2: an editor component -- Qtmacs style.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialTextEdit</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple text editor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QTextEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTextEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Tutorial 2: a macro driven text editor.&#39;</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs, create an instance of it, and</span>
<span class="c"># display it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialTextEdit</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
<span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">InsertE</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Insert the character &#39;e&#39;.</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    |Signature|</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    * *applet*: &#39;*&#39;</span>
</span><span class="hll"><span class="sd">    * *widget*: &#39;*&#39;</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">textCursor</span><span class="p">()</span><span class="o">.</span><span class="n">insertText</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="c"># Register the macro with Qtmacs and bind it to the &#39;e&#39; key.</span>
</span><span class="hll"><span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">InsertE</span><span class="p">)</span>
</span><span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>The only notable difference to the boiler plate code from the <a class="reference internal" href="#macros">Macros</a>
section is Line 52 which uses the <tt class="docutils literal"><span class="pre">qteWidget</span></tt> attribute to access the
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a>. This attribute is available to all macros and always
points to the widget that was active when the macro was triggered.
Of course, the active widget could be anything and our code should
therefore check that <tt class="docutils literal"><span class="pre">qteWidget</span></tt> actually <em>is</em> a
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a>. However, there are smarter ways to ensure that the macro
is only called for <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> widgets (see <a class="reference internal" href="#signatures"><em>Signatures</em></a>).</p>
<p>In this example we therefore keep assuming that <tt class="docutils literal"><span class="pre">qteWidget</span></tt> always does
point to a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a>, which is reasonable because it is the only
widget in the applet. If we now press <tt class="docutils literal"><span class="pre">e</span></tt> the corresponding letter
will appear because Line 57 bound that key to our macro.</p>
<p id="lastkeysequence">In principle we could now write a macro for every letter but that would
be tedious. A more efficient way is to use the same macro for every
printable key, if only the macro knew which key was pressed. Fortunately,
this information is always available in the global variable
<tt class="docutils literal"><span class="pre">last_key_sequence</span></tt> which references a <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsKeysequence" title="qtmacs.auxiliary.QtmacsKeysequence"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsKeysequence</span></tt></a>
instance. This class represents all key sequences inside Qtmacs and
facilitates certain operations and conversions on it. The
conversion of interest to us here is <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsKeysequence.toQKeyEventList" title="qtmacs.auxiliary.QtmacsKeysequence.toQKeyEventList"><tt class="xref py py-mod docutils literal"><span class="pre">toQKeyEventList</span></tt></a>
because it returns the key sequence as a list of <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qkeyevent.html">QKeyEvent</a>
objects. These objects, in turn, have a <a class="reference external" href="QKeyEvent.text">text()</a> method (see Qt
documentation for details) to retrieve the character (if it is
printable).</p>
<p>We may therefore improve upon the previous code as follows:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 2: an editor component -- Qtmacs style.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialTextEdit</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple text editor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QTextEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTextEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Tutorial 2: a macro driven text editor.&#39;</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs, create an instance of it, and</span>
<span class="c"># display it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialTextEdit</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InsertE</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the character &#39;e&#39;.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="hll">        <span class="c"># Extract the list of QKeyEvents that triggered this very</span>
</span><span class="hll">        <span class="c"># macro from the global variable ``last_key_sequence``. This</span>
</span><span class="hll">        <span class="c"># returns a list.</span>
</span><span class="hll">        <span class="n">keys</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">last_key_sequence</span><span class="o">.</span><span class="n">toQKeyEventList</span><span class="p">()</span>
</span><span class="hll">
</span><span class="hll">        <span class="c"># The list should contain only one element for single keys but</span>
</span><span class="hll">        <span class="c"># to be sure pick only the last one. This will return a</span>
</span><span class="hll">        <span class="c"># Qt-native QKeyEvent object.</span>
</span><span class="hll">        <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span class="hll">
</span><span class="hll">        <span class="c"># Access the text() method of this object to retrieve the</span>
</span><span class="hll">        <span class="c"># typed character.</span>
</span><span class="hll">        <span class="n">ch</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
</span><span class="hll">
</span>        <span class="c"># Insert the character into the QTextEdit.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">textCursor</span><span class="p">()</span><span class="o">.</span><span class="n">insertText</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>


<span class="c"># Register the macro with Qtmacs and bind it to the &#39;e&#39; key.</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">InsertE</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>This macro is already more flexible but still only works for the <tt class="docutils literal"><span class="pre">e</span></tt>-key
because it has not yet been bound to other keys. The following code
addresses this shortcoming and also renames the macro name to the more
generic <tt class="docutils literal"><span class="pre">InsertCharacter</span></tt>:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 2: an editor component -- Qtmacs style.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialTextEdit</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple text editor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QTextEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTextEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Tutorial 2: a macro driven text editor.&#39;</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs, create an instance of it, and</span>
<span class="c"># display it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialTextEdit</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InsertCharacter</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the character &#39;e&#39;.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Extract the list of QKeyEvents that triggered this very</span>
        <span class="c"># macro from the global variable ``last_key_sequence``. This</span>
        <span class="c"># returns a list.</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">last_key_sequence</span><span class="o">.</span><span class="n">toQKeyEventList</span><span class="p">()</span>

        <span class="c"># The list should contain only one element for single keys but</span>
        <span class="c"># to be sure pick only the last one. This will return a</span>
        <span class="c"># Qt-native QKeyEvent object.</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># Access the text() method of this object to retrieve the</span>
        <span class="c"># typed character.</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c"># Insert the character into the QTextEdit.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">textCursor</span><span class="p">()</span><span class="o">.</span><span class="n">insertText</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>


<span class="c"># Register the macro with Qtmacs and bind it to all lower case keys.</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">InsertCharacter</span><span class="p">)</span>
<span class="hll"><span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s">&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span><span class="p">:</span>
</span><span class="hll">    <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>The widget can now displays all the basic alphanumerical characters
except white space. Unlike the other characters, this one cannot be
specified as <tt class="docutils literal"><span class="pre">&quot;</span> <span class="pre">&quot;</span></tt> because white spaces are used to separate keys in
key sequences. If we try nevertheless, then Qtmacs will raise the
following error:</p>
<div class="figure align-center">
<img alt="_images/tut_2_4.png" src="_images/tut_2_4.png" style="width: 700px;" />
<p class="caption">The log viewer reports an error because the argument to
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyGlobal</span></tt></a> was invalid.</p>
</div>
<p>To bind non-standard keys it is necessary to enclose them in angular
brackets, eg. <tt class="docutils literal"><span class="pre">&lt;space&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;enter&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;tab&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;F1&gt;</span></tt>.
However, since our <tt class="docutils literal"><span class="pre">InsertCharacter</span></tt> macro relies on the <a class="reference external" href="QKeyEvent.text">text()</a> method of <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qkeyevent.html">QKeyEvent</a> it will still do nothing for
unprintable keys like <tt class="docutils literal"><span class="pre">&lt;F1&gt;</span></tt>.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 2: an editor component -- Qtmacs style.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialTextEdit</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple text editor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QTextEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTextEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Tutorial 2: a macro driven text editor.&#39;</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs, create an instance of it, and</span>
<span class="c"># display it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialTextEdit</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InsertCharacter</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the character &#39;e&#39;.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Extract the list of QKeyEvents that triggered this very</span>
        <span class="c"># macro from the global variable ``last_key_sequence``. This</span>
        <span class="c"># returns a list.</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">last_key_sequence</span><span class="o">.</span><span class="n">toQKeyEventList</span><span class="p">()</span>

        <span class="c"># The list should contain only one element for single keys but</span>
        <span class="c"># to be sure pick only the last one. This will return a</span>
        <span class="c"># Qt-native QKeyEvent object.</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># Access the text() method of this object to retrieve the</span>
        <span class="c"># typed character.</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c"># Insert the character into the QTextEdit.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">textCursor</span><span class="p">()</span><span class="o">.</span><span class="n">insertText</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>


<span class="c"># Register the macro with Qtmacs and bind it to all lower case keys.</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">InsertCharacter</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s">&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span><span class="p">:</span>
    <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;space&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>People unfamiliar with Emacs (who will probably not read this tutorial
anyway) may object that it is redundant to use macros for inserting
characters into a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> because that widget is perfectly capable
of doing so itself. However, since now every action is governed by
macros this also implies that any action can easily be altered with
a new macro; no change in the source code of the widget or Qtmacs is
necessary for that. For instance, a <tt class="docutils literal"><span class="pre">&lt;tab&gt;</span></tt> may do nothing, or insert
white-space, or open a new applet, or play music, or do all of it, or
nothing. Furthermore, this behaviour can be customised to every applet,
and even every widget inside an applet (see <a class="reference internal" href="#signatures"><em>Signatures</em></a> for more
details). For instance, a <tt class="docutils literal"><span class="pre">&lt;tab&gt;</span></tt> in one <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> may open a new
applet to show possible completions, whereas in another <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> it
may insert white-space, and in a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qwebview.html">QWebView</a> it may open the browser
history.</p>
<p>Now that the widget reacts to (most) keys in the expected way we want to
endow it with navigation macros. The principle is the same as before:</p>
<ul class="simple">
<li>write a macro that uses Qt-native methods of the <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> to move
the cursor,</li>
<li>register it with Qtmacs,</li>
<li>bind it to a key (optional).</li>
</ul>
<p>Here is an example for how to delete a character and move the caret to
the left (refer to <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qtextcursor.html">QTextCursor</a> for details on how the code works):</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 2: an editor component -- Qtmacs style.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialTextEdit</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple text editor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QTextEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTextEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Tutorial 2: a macro driven text editor.&#39;</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs, create an instance of it, and</span>
<span class="c"># display it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialTextEdit</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InsertCharacter</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the character &#39;e&#39;.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Extract the list of QKeyEvents that triggered this very</span>
        <span class="c"># macro from the global variable ``last_key_sequence``. This</span>
        <span class="c"># returns a list.</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">last_key_sequence</span><span class="o">.</span><span class="n">toQKeyEventList</span><span class="p">()</span>

        <span class="c"># The list should contain only one element for single keys but</span>
        <span class="c"># to be sure pick only the last one. This will return a</span>
        <span class="c"># Qt-native QKeyEvent object.</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="n">keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c"># Access the text() method of this object to retrieve the</span>
        <span class="c"># typed character.</span>
        <span class="n">ch</span> <span class="o">=</span> <span class="n">keys</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c"># Insert the character into the QTextEdit.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">textCursor</span><span class="p">()</span><span class="o">.</span><span class="n">insertText</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>


<span class="c"># Register the macro with Qtmacs and bind it to all lower case keys.</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">InsertCharacter</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="s">&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span><span class="p">:</span>
    <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;space&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DelCharBackward</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
<span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Delete character the left of the cursor.</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    |Signature|</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    * *applet*: &#39;*&#39;</span>
</span><span class="hll"><span class="sd">    * *widget*: &#39;*&#39;</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">textCursor</span><span class="p">()</span><span class="o">.</span><span class="n">deletePreviousChar</span><span class="p">()</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">BackwardChar</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Move cursor one character to the left.</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    |Signature|</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    * *applet*: &#39;*&#39;</span>
</span><span class="hll"><span class="sd">    * *widget*: &#39;*&#39;</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="n">tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">textCursor</span><span class="p">()</span>
</span><span class="hll">        <span class="n">tc</span><span class="o">.</span><span class="n">movePosition</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTextCursor</span><span class="o">.</span><span class="n">PreviousCharacter</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setTextCursor</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">DelCharBackward</span><span class="p">)</span>
</span><span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;backspace&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">BackwardChar</span><span class="p">)</span>
</span><span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+b&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>We could now proceed to write all the other navigation- and text editing
macros but this would be cumbersome. For standard widgets like a
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> this has been done already and Qtmacs can apply them
automatically. To do so, set the <tt class="docutils literal"><span class="pre">autoBind</span></tt> flag in Line 25 to
<strong>True</strong>, or drop the parameter altogether (<strong>True</strong> is its default). We
may then also remove our custom macros and bindings:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 2: an editor component -- Qtmacs style.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialTextEdit</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A simple text editor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QTextEdit widget to the applet.</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QTextEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Tutorial 2: a macro driven text editor.&#39;</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs, create an instance of it, and display it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialTextEdit</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>That easy, just like a normal PyQt program but with all the flexibility
of the macro framework. The last modification should be to replace the
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> with the drop-in replacement <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.extensions.qtmacstextedit_widget.QtmacsTextEdit" title="qtmacs.extensions.qtmacstextedit_widget.QtmacsTextEdit"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsTextEdit</span></tt></a>. This widget
was adapted for Qtmacs to emulate the undo behaviour of Emacs, but is
otherwise the same.</p>
<p>To find out which other widgets have default bindings check out the
<tt class="docutils literal"><span class="pre">default_widget_keybindings</span></tt> dictionary in the <cite>qtmacs/qte_global.py</cite>
file. It states, for instance, that the macros for <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> are
defined in <cite>qtmacs/extensions/qtmacstextedit_macros.py</cite>.</p>
</div>
<div class="section" id="logging">
<span id="id3"></span><h2>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h2>
<p>Qtmacs` logging facilities leverage the <a class="reference external" href="http://docs.python.org/3.2/library/logging.html?highlight=logging#logging">logging module</a>
module from the standard Python library. Upon startup Qtmacs will spawn
a LogViewer applet which automatically connects to it and displays all
log messages henceforth.</p>
<p>To log such a message, use the <tt class="docutils literal"><span class="pre">qteLogger</span></tt> attribute which is
automatically available to every macro and applet. The usage is
explained in detail in the <a class="reference external" href="http://docs.python.org/3.2/library/logging.html?highlight=logging#logging">logging module</a> documentation, but here are
the typical use cases:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Debug message&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Info message&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Warning message&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Error message&#39;</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">&#39;Critical message&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>All of these can also be called with the <tt class="docutils literal"><span class="pre">stack_info=True</span></tt> to log a
the current stack trace as well. The LogViewer applet is smart enough to
identify these traces and displays them accordingly.</p>
<p>To try out the logging features, create a file <cite>logdemo.py</cite> with the
following content:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Get a handle to the main instance of Qtmacs.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>

<span class="c"># Log messages without a stack trace.</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;Debug message.&#39;</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Info message.&#39;</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Warning message.&#39;</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Error message.&#39;</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">&#39;Critical message.&#39;</span><span class="p">)</span>

<span class="c"># A log message with a stack trace.</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Warning message with stack trace.&#39;</span><span class="p">,</span> <span class="n">stack_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c"># Deliberately cause an exception to demonstrate the use of</span>
<span class="c"># qteLogger.exception() as well.</span>
<span class="k">try</span><span class="p">:</span>
    <span class="mi">1</span><span class="o">/</span><span class="mi">0</span>
<span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
    <span class="n">qteMain</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s">&#39;An exception occurred.&#39;</span><span class="p">,</span>
                             <span class="n">exc_info</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stack_info</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Then start Qtmacs with</p>
<div class="highlight-bash"><div class="highlight"><pre>./qtmacs.py --load logdemo.py
</pre></div>
</div>
<p>to generate the following output in the LogViewer:</p>
<div class="figure align-center">
<img alt="_images/logdemo.png" src="_images/logdemo.png" style="width: 700px;" />
<p class="caption">The logging messages created by <cite>logdemo.py</cite>.</p>
</div>
</div>
<div class="section" id="additional-examples">
<h2>Additional Examples<a class="headerlink" href="#additional-examples" title="Permalink to this headline">¶</a></h2>
<p>The following applets do not introduce any new Qtmacs concepts
but help to illustrate the liberal interplay with the Qt library.</p>
<div class="section" id="web-browser">
<span id="webbrowser"></span><h3>Web Browser<a class="headerlink" href="#web-browser" title="Permalink to this headline">¶</a></h3>
<p>A web browser is easy to implement with Qt because the <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qwebview.html">QWebView</a>
widget already does all the work. Integrating this widget into a Qtmacs
applet is also straightforward, and with the right set of macros it
would be even possible to combine the convenience of web-mail services
with an Emacs like editor experience &#8211; all without any support from the
web page or an external browser.</p>
<p>The <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qwebview.html">QWebView</a> class is rich in methods but (necessarily) HTML
oriented. The interaction with the widget (eg. moving the cursor,
determining its position, inserting characters, cycling through editable
web elements, ...) therefore requires either pre-defined methods to
support this, or custom JavaScript code.</p>
<p>The applet developed here may not be particularly impressive due to my
lack of JavaScript knowledge yet is still good enough to demonstrate the
seamless integration with Qtmacs and its macros.</p>
<p>In the first step we create an applet with a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qwebview.html">QWebView</a> and point it
to Google.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWebKit</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">DemoWeb</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Web Browser Demo.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a webView element and point it to an initial location.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtWebKit</span><span class="o">.</span><span class="n">QWebView</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QUrl</span><span class="p">(</span><span class="s">&#39;http://www.google.com.au&#39;</span><span class="p">))</span>

<span class="c"># Register the applet and create an instance thereof.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">DemoWeb</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="figure align-center">
<img alt="_images/tut_7_1.png" src="_images/tut_7_1.png" style="width: 700px;" />
<p class="caption">A <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qwebview.html">QWebView</a> in action.</p>
</div>
<p>Then we add two macros to scroll the page up and down and bind them to
<tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+p</span></tt> and <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+n</span></tt>, respectively. To implement this the
macros will first determine the size of the visible area (via
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/qwebpage.html#viewportSize-prop">page().viewportSize</a>),
compute 25% of that, and call <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qwebframe.html#scroll">mainFrame().scroll</a> to scroll the
page.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWebKit</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">DemoWeb</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Web Browser Demo.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a webView element and point it to an initial location.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtWebKit</span><span class="o">.</span><span class="n">QWebView</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QUrl</span><span class="p">(</span><span class="s">&#39;http://www.google.com.au&#39;</span><span class="p">))</span>

<span class="hll">        <span class="c"># Register and bind the macros.</span>
</span><span class="hll">        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">ScrollDown</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+n&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
</span><span class="hll">        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">ScrollUp</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+p&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">ScrollDown</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Move the web page down by 25% of its visible size.</span>
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoWeb&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QWebView&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="c"># Compute 25% of the currently visible web-page height (in pixels).</span>
</span><span class="hll">        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">viewportSize</span><span class="p">()</span>
</span><span class="hll">        <span class="n">inc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="c"># Move the web page ``inc`` pixels up.</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">mainFrame</span><span class="p">()</span><span class="o">.</span><span class="n">scroll</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">+</span><span class="n">inc</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">ScrollUp</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Move the web page up by 25% of its visible size.</span>
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoWeb&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QWebView&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="c"># Compute 25% of the currently visible web-page height (in pixels).</span>
</span><span class="hll">        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">viewportSize</span><span class="p">()</span>
</span><span class="hll">        <span class="n">inc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="c"># Move the web page ``inc`` pixels up.</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">mainFrame</span><span class="p">()</span><span class="o">.</span><span class="n">scroll</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">inc</span><span class="p">)</span>
</span>

<span class="c"># Register the applet and create an instance thereof.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">DemoWeb</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>To try out the macros it may be necessary to shrink the window until
vertical scroll bars appear.</p>
<p>So far it is still impossible to enter any text. To remedy this we pass
on all alphanumerical keys to the native <tt class="docutils literal"><span class="pre">keyPressEvent</span></tt> method which
takes care of the details.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWebKit</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">DemoWeb</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Web Browser Demo.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a webView element and point it to an initial location.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtWebKit</span><span class="o">.</span><span class="n">QWebView</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QUrl</span><span class="p">(</span><span class="s">&#39;http://www.google.com.au&#39;</span><span class="p">))</span>

        <span class="c"># Register and bind the macros.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">ScrollDown</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+n&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">ScrollUp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+p&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>

<span class="hll">        <span class="c"># Bind it the standard alphanumerical keys.</span>
</span><span class="hll">        <span class="n">alpha_keys</span> <span class="o">=</span> <span class="s">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>
</span><span class="hll">        <span class="n">alpha_keys</span> <span class="o">+=</span> <span class="n">alpha_keys</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;0123456789&#39;</span>
</span><span class="hll">        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">SelfInsert</span><span class="p">)</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">alpha_keys</span><span class="p">:</span>
</span><span class="hll">            <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="c"># Also bind the &lt;space&gt;, &lt;enter&gt;, and &lt;backspace&gt; key.</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;space&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;backspace&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
</span>

<span class="k">class</span> <span class="nc">ScrollDown</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move the web page down by 25% of its visible size.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoWeb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QWebView&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Compute 25% of the currently visible web-page height (in pixels).</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">viewportSize</span><span class="p">()</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">)</span>

        <span class="c"># Move the web page ``inc`` pixels up.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">mainFrame</span><span class="p">()</span><span class="o">.</span><span class="n">scroll</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">+</span><span class="n">inc</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ScrollUp</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move the web page up by 25% of its visible size.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoWeb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QWebView&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Compute 25% of the currently visible web-page height (in pixels).</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">viewportSize</span><span class="p">()</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">)</span>

        <span class="c"># Move the web page ``inc`` pixels up.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">mainFrame</span><span class="p">()</span><span class="o">.</span><span class="n">scroll</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">inc</span><span class="p">)</span>


<span class="hll"><span class="k">class</span> <span class="nc">SelfInsert</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Insert a character into the active element.</span>
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoWeb&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QWebView&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="n">last_key</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">last_key_sequence</span><span class="o">.</span><span class="n">toQKeyEventList</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">last_key</span><span class="p">)</span>
</span>

<span class="c"># Register the applet and create an instance thereof.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">DemoWeb</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="figure align-center">
<img alt="_images/tut_7_2.png" src="_images/tut_7_2.png" style="width: 700px;" />
<p class="caption">A sample query.</p>
</div>
<p>The last addition in this tutorial are two macros to move the caret
forwards and backwards. The <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qwebview.html">QWebView</a> already provides pre-defined
<cite>actions</cite> to furnish the necessary functionality:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWebKit</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">DemoWeb</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A Web Browser Demo.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a webView element and point it to an initial location.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtWebKit</span><span class="o">.</span><span class="n">QWebView</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QUrl</span><span class="p">(</span><span class="s">&#39;http://www.google.com.au&#39;</span><span class="p">))</span>

        <span class="c"># Register and bind the macros.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">ScrollDown</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+n&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">ScrollUp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+p&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>

        <span class="c"># Bind it the standard alphanumerical keys.</span>
        <span class="n">alpha_keys</span> <span class="o">=</span> <span class="s">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>
        <span class="n">alpha_keys</span> <span class="o">+=</span> <span class="n">alpha_keys</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39;0123456789&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">SelfInsert</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">alpha_keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>

        <span class="c"># Also bind the &lt;space&gt;, &lt;enter&gt;, and &lt;backspace&gt; key.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;space&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;backspace&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>

<span class="hll">        <span class="c"># Register and bind macro to move the cursor to the left and right.</span>
</span><span class="hll">        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">BackwardChar</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+b&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
</span><span class="hll">        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">ForwardChar</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+f&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWeb</span><span class="p">)</span>
</span>

<span class="k">class</span> <span class="nc">ScrollDown</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move the web page down by 25% of its visible size.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoWeb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QWebView&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Compute 25% of the currently visible web-page height (in pixels).</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">viewportSize</span><span class="p">()</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">)</span>

        <span class="c"># Move the web page ``inc`` pixels up.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">mainFrame</span><span class="p">()</span><span class="o">.</span><span class="n">scroll</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">+</span><span class="n">inc</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ScrollUp</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move the web page up by 25% of its visible size.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoWeb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QWebView&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Compute 25% of the currently visible web-page height (in pixels).</span>
        <span class="n">size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">viewportSize</span><span class="p">()</span>
        <span class="n">inc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">size</span><span class="o">.</span><span class="n">height</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">)</span>

        <span class="c"># Move the web page ``inc`` pixels up.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">page</span><span class="p">()</span><span class="o">.</span><span class="n">mainFrame</span><span class="p">()</span><span class="o">.</span><span class="n">scroll</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">inc</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SelfInsert</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert a character into the active element.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoWeb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QWebView&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">last_key</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">last_key_sequence</span><span class="o">.</span><span class="n">toQKeyEventList</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">last_key</span><span class="p">)</span>


<span class="hll"><span class="k">class</span> <span class="nc">BackwardChar</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Move the caret one character back.</span>
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoWeb&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QWebView&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">triggerPageAction</span><span class="p">(</span><span class="n">QtWebKit</span><span class="o">.</span><span class="n">QWebPage</span><span class="o">.</span><span class="n">MoveToPreviousChar</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="k">class</span> <span class="nc">ForwardChar</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Move the caret one character forward.</span>
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoWeb&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QWebView&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">triggerPageAction</span><span class="p">(</span><span class="n">QtWebKit</span><span class="o">.</span><span class="n">QWebPage</span><span class="o">.</span><span class="n">MoveToNextChar</span><span class="p">)</span>
</span>

<span class="c"># Register the applet and create an instance thereof.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">DemoWeb</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The applet has now a basic set of features and the keyboard shortcuts
for page scrolling and cursor movements are consistent with those in the
text applet. However, the example relies on explicit <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qwebview.html">QWebView</a>
methods to implement these features (eg. <tt class="docutils literal"><span class="pre">keyPressEvent</span></tt> method or
web-actions). This suffices for the purposes of this demo but more
sophisticated operations like copying- or inserting characters at a
particular position are not possible with them. To implement them anyway
some JavaScript code is likely going to be mandatory. Any help
with this is welcome, as well as are extensions to the applet itself
(ie. the ability to visit other websites than Google would already make
it remotely useful).</p>
</div>
<div class="section" id="threading">
<span id="threadingdev"></span><h3>Threading<a class="headerlink" href="#threading" title="Permalink to this headline">¶</a></h3>
<p>Qtmacs itself is not, and never will be, a multi threaded
application. The simple reason is that Qt demands that all GUI elements
(ie. everything from <tt class="docutils literal"><span class="pre">QtGui.*</span></tt>) runs in the same thread, which
necessarily includes all the Qtmacs windows and applets.</p>
<p>However, non-GUI related code is not affected by this restriction.
Computationally intense routines can therefore be moved into a separate
thread and use Qt signals to report results back to the applet which
can then update its widgets accordingly.</p>
<p>This tutorial shows a simple threading example with two classes: a
<tt class="docutils literal"><span class="pre">Worker</span></tt> with a <tt class="docutils literal"><span class="pre">work</span></tt> method that uses blocking sleep calls to
periodically trigger a signal, and an applet that updates a progress bar
every time the signal is emitted. Here is the code without threads:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWebKit</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">Worker</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use blocking sleep-calls to periodically emit a signal.</span>

<span class="sd">    This thread uses blocking sleep-calls to simulate time consuming</span>
<span class="sd">    operations that will block the GUI when run in the main thread.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sigStartWork</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="n">sigUpdate</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigStartWork</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">work</span><span class="p">)</span>

    <span class="c"># Explicitly mark the method as a Qt slot to ensure signals are</span>
    <span class="c"># delivered correctly across threads.</span>
    <span class="nd">@QtCore.pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use a blocking &lt;sleep&gt; call to periodically trigger a signal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigUpdate</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DemoThread</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Demonstrate threading and a non-blocking GUI.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a progress-bar element to the applet and register it with Qtmacs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteProgBar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QProgressBar</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteProgBar</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteProgBar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>

        <span class="c"># Instantiate the worker object and connect the trigger signal to the</span>
        <span class="c"># &quot;setValue&quot; slot of the progress bar.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">sigUpdate</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteProgBar</span><span class="o">.</span><span class="n">setValue</span><span class="p">)</span>

        <span class="c"># Start the work in the worker thread.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">sigStartWork</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>


<span class="c"># Register the applet and create an instance thereof.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">DemoThread</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The <tt class="docutils literal"><span class="pre">DemoThread</span></tt> applet first instantiates a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qprogressbar.html">QProgressBar</a> and
<tt class="docutils literal"><span class="pre">Worker</span></tt> object. Then it connects the <tt class="docutils literal"><span class="pre">sigUpdate</span></tt> signal from the
<tt class="docutils literal"><span class="pre">worker</span></tt> to the <tt class="docutils literal"><span class="pre">setValue</span></tt> slot of <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qprogressbar.html">QProgressBar</a>. Finally, it
triggers the work in the <tt class="docutils literal"><span class="pre">worker</span></tt> object with the <tt class="docutils literal"><span class="pre">sigStartWork</span></tt>
signal.</p>
<p>While the whole setup with all the signals is somewhat redundant for a
single threaded setup it will require only a negligible modification to
turn it into a multi threaded version. Beforehand, though,
we want to try out this version.</p>
<p>The result: for the first 3 seconds Qtmacs will be frozen because of
the blocking sleep calls. Afterwards it will come back to life with a
full progress bar &#8211; expected, but unsatisfactory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">Worker</span></tt> object must be based on <tt class="docutils literal"><span class="pre">QtCore.QObject</span></tt>, or
any other non-GUI class from the Qt library that inherits it, as
otherwise the signal-slot mechanism will not work.</p>
</div>
<p>The next version will be better because it moves the worker object into
a separate thread:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69</pre></div></td><td class="code"><div class="highlight"><pre><span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWebKit</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">Worker</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QObject</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use blocking sleep-calls to periodically emit a signal.</span>

<span class="sd">    This thread uses blocking sleep-calls to simulate time consuming</span>
<span class="sd">    operations that will block the GUI when run in the main thread.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">sigStartWork</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">()</span>
    <span class="n">sigUpdate</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigStartWork</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">work</span><span class="p">)</span>

    <span class="c"># Explicitly mark the method as a Qt slot to ensure signals are</span>
    <span class="c"># delivered correctly across threads.</span>
    <span class="nd">@QtCore.pyqtSlot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Use a blocking &lt;sleep&gt; call to periodically trigger a signal.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">time</span>
<span class="hll">        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
</span>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigUpdate</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">val</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DemoThread</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Demonstrate threading and a non-blocking GUI.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a progress-bar element to the applet and register it with Qtmacs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteProgBar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QProgressBar</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteProgBar</span><span class="o">.</span><span class="n">setMinimum</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteProgBar</span><span class="o">.</span><span class="n">setMaximum</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
</span>
        <span class="c"># Instantiate the worker object and connect the trigger signal to the</span>
        <span class="c"># &quot;setValue&quot; slot of the progress bar.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">sigUpdate</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteProgBar</span><span class="o">.</span><span class="n">setValue</span><span class="p">)</span>

<span class="hll">        <span class="c"># Create a Qt thread, move the worker into the thread, and</span>
</span><span class="hll">        <span class="c"># start the thread.</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span>
        <span class="c"># Start the work in the worker thread.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">worker</span><span class="o">.</span><span class="n">sigStartWork</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>


<span class="c"># Register the applet and create an instance thereof.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">DemoThread</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Line 32 increase the time spent in the method (to better experiment
with it) and Line 58 updates the maximum value of the progress bar
accordingly. The only new additions are Lines 56-60 which
instantiate a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qthread.html">QThread</a> and push the worker into it.</p>
<p>This time, the progress bar updates continually and Qtmacs remains
responsive as well, which implies that applet switching and
macro execution work as usual while the progress bar updates. The
screenshot below shows the effect of splitting the applet with the
progress bar during its execution.</p>
<div class="figure align-center">
<img alt="_images/tut_4_2.png" src="_images/tut_4_2.png" style="width: 700px;" />
</div>
<div class="section" id="threading-pitfalls">
<h4>Threading Pitfalls<a class="headerlink" href="#threading-pitfalls" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">One notable disadvantage of threads is their potential to cause a
segfault when the applet is killed. If that happens then Qtmacs,
together with all its applets, are terminated immediately and
irrevocably by the OS.</p>
</div>
<p>There are two typical reasons for when the segfault occurs, and neither
is Qtmacs specific:</p>
<ol class="arabic simple">
<li>the worker calls a method of the killed applet,</li>
<li>the worker uses a signal defined in the killed applet.</li>
</ol>
<p>In both cases a dangling pointer is accessed and neither PyQt, nor Qt,
nor Python can safe the program from being terminated by the OS anymore
at that point.</p>
<p>The remedy to case 1) is simple: improve your code; objects in different
threads have no business calling each others&#8217; methods directly. The same
functionality can always be reproduced with Qt signals, which are thread
safe by design.</p>
<p>The remedy to option 2) is to <em>never</em> use any variables in the worker
class that were not defined in that very class. This includes static
signal definitions.</p>
<p>The reason is that the applet may die (because Qtmacs kills it), but the
worker thread may not. This is perfectly safe unless the worker decides to
directly access variables from the non-existing applet, eg. a signal
that was defined there. For this reason all signals in the
above example were <em>defined in the worker</em>, and neither the worker nor
the applet called any of the others&#8217; methods directly. The only
exception is Line 54 to connect the signal, but at that point it is
guaranteed that both objects exist and still live in the same thread.</p>
<p>Two questions that may arise in this context:</p>
<ol class="arabic simple">
<li>Why does Qtmacs not kill the thread when it kills the applet?</li>
<li>Why is it safe to kill the applet when signals are still connected to
another thread?</li>
</ol>
<p>The answer to the first question is simply that Qtmacs does not know
about the thread (or the worker). Nevertheless, before Qtmacs kills an
applet it calls the <tt class="docutils literal"><span class="pre">qteToBeKilled</span></tt> method of that applet. Ideally,
this method terminates any running threads spawned by that applet.</p>
<p>The answer to the second question is that PyQt and Qt automatically
disconnect all signals from the object before deleting it. As a result,
the thread may safely continue to emit signals, although no one may be
listening anymore.</p>
<p>The bottom line here is that threaded applets are a good idea as long as
no direct method calls are used, all signals are defined in the
worker, and Qt threads are used instead of Python&#8217;s threading
module. Explicitly testing what happens when the applet is killed is
usually a good idea as well.</p>
</div>
</div>
<div class="section" id="pdf-viewer">
<span id="pdfviewerdev"></span><h3>PDF Viewer<a class="headerlink" href="#pdf-viewer" title="Permalink to this headline">¶</a></h3>
<p>This section implements a PDF viewer based on the <a class="reference external" href="http://poppler.freedesktop.org/">Poppler</a> library which also has
a <a class="reference external" href="http://people.freedesktop.org/~aacid/docs/qt4/">Qt4 interface</a>.
This interface was wrapped once more by the <a class="reference external" href="http://code.google.com/p/python-poppler-qt4/">Python-Poppler-Qt4</a> project to provide
Python bindings. Unfortunately, the project does not appear to be
maintained anymore and the bindings do not compile out-of-the-box with
Python 3, at least not for me. The first part of this section will
therefore explain how I got it to work, before the second part
demonstrates its use in a Qtmacs applet.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If anyone knows how to take the hassle out of this (eg. with
statically compiled libraries for all major platforms), then
please <a class="reference external" href="mailto:qtmacsdev&#37;&#52;&#48;gmail&#46;com">drop me a line</a>.</p>
</div>
<div class="section" id="compiling-popplerqt4">
<span id="compilepoppler"></span><h4>Compiling <cite>popplerqt4</cite><a class="headerlink" href="#compiling-popplerqt4" title="Permalink to this headline">¶</a></h4>
<p>The following steps compiled the popplerqt4 library on Kubuntu 12.04 (64Bit):</p>
<ol class="arabic">
<li><p class="first">Check out the latest version of the library with:</p>
<div class="highlight-python"><pre>svn checkout http://python-poppler-qt4.googlecode.com/svn/trunk/</pre>
</div>
</li>
<li><p class="first">Move into the <cite>trunk/python-poppler-qt4/</cite> directory, open
<tt class="docutils literal"><span class="pre">setup.py</span></tt> in an editor, and replace the two occurrences of:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>with:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">output</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span><span class="o">.</span><span class="n">communicate</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Open <tt class="docutils literal"><span class="pre">sipdistutils.py</span></tt>
(&#8220;/usr/lib/python3/dist-packages/sipdistutils.py&#8221; on my machine) and
inside <tt class="docutils literal"><span class="pre">_get_sip_output</span></tt> replace:</p>
<div class="highlight-python"><pre>for L in file(sbf):</pre>
</div>
<p>with:</p>
<div class="highlight-python"><pre>for L in open(sbf).readlines():</pre>
</div>
</li>
</ol>
<p>The changes in 2) pertain to the new byte string handling in Python 3,
and the changes in 3) replace the deprecated <tt class="docutils literal"><span class="pre">file()</span></tt> function with
the endorsed <tt class="docutils literal"><span class="pre">open().readlines()</span></tt> statement.</p>
<p>Now build and install the <tt class="docutils literal"><span class="pre">popplerqt4</span></tt> module as usual:</p>
<div class="highlight-bash"><div class="highlight"><pre>python3 setup.py build
python3 setup.py install
</pre></div>
</div>
<p>and run the supplied demo to test it:</p>
<div class="highlight-bash"><div class="highlight"><pre>python3 demo.py some_pdf_file.pdf
</pre></div>
</div>
</div>
<div class="section" id="pdf-viewer-applet">
<h4>PDF Viewer Applet<a class="headerlink" href="#pdf-viewer-applet" title="Permalink to this headline">¶</a></h4>
<p>With the help of <tt class="docutils literal"><span class="pre">popplerqt4</span></tt> it is now possible to build a simple PDF
viewer akin to the <a class="reference external" href="http://doc.qt.digia.com/qq/qq27-poppler.html">C++ demo supplied by the Qt developers</a>. The basic idea is to
convert the PDF pages into images, display them on a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlabel.html">QLabel</a>, and put
that <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlabel.html">QLabel</a> inside a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qscrollarea.html">QScrollArea</a> for scrolling support.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To use your own PDF file instead of
<a class="reference external" href="http://www.riverbankcomputing.co.uk/static/Docs/PyQt4/pyqt-whitepaper-a4.pdf">PyQt4 whitepaper</a>
adapt Line 21 accordingly.</p>
</div>
<p>Create a new file <cite>tut_6.py</cite> and populate it with</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">popplerqt4</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>

<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWebKit</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">DemoPDF</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display the first page of a PDF file using Python-Poppler library.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base classes.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Load the PDF document with the Poppler library.</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">popplerqt4</span><span class="o">.</span><span class="n">Poppler</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;demos/pyqt-whitepaper-a4.pdf&#39;</span><span class="p">)</span>

        <span class="c"># Enable antialiasing to improve the readability of the fonts.</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">setRenderHint</span><span class="p">(</span><span class="n">popplerqt4</span><span class="o">.</span><span class="n">Poppler</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">Antialiasing</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">setRenderHint</span><span class="p">(</span><span class="n">popplerqt4</span><span class="o">.</span><span class="n">Poppler</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">TextAntialiasing</span><span class="p">)</span>

        <span class="c"># Convert the first page to an image and install it as the</span>
        <span class="c"># pixmap of a QLabel.</span>
        <span class="n">pdf_img</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">renderToImage</span><span class="p">()</span>
        <span class="n">pdf_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">())</span>
        <span class="n">pdf_label</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">pdf_img</span><span class="p">))</span>

        <span class="c"># Add a QScrollArea and place the pdf_label inside.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteScroll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QScrollArea</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteScroll</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">pdf_label</span><span class="p">)</span>

        <span class="c"># Put it all into a layout as Qtmacs will otherwise try to</span>
        <span class="c"># arrange it automatically, which is generally a bad idea when</span>
        <span class="c"># more than one widget is involved.</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteScroll</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hbox</span><span class="p">)</span>


<span class="c"># Register the applet and create an instance thereof.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">DemoPDF</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Then start Qtmacs with</p>
<div class="highlight-bash"><div class="highlight"><pre>./qtmacs.py --load tut_6.py
</pre></div>
</div>
<p>which should display the first page of the PDF document like so:</p>
<div class="figure align-center">
<img alt="_images/tut_6_1.png" src="_images/tut_6_1.png" style="width: 700px;" />
<p class="caption">First page of PyQt4 whitepaper.</p>
</div>
<p>The first and last extension in this tutorial are macros to
scroll the page up- and down by 10% of its height. To mimic the
shortcuts for moving the cursor up and down in a text applet, these
macros will also be bound to <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+p</span></tt> and <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+n</span></tt>.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84</pre></div></td><td class="code"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">import</span> <span class="nn">popplerqt4</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWebKit</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">DemoPDF</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Display the first page of a PDF file using Python-Poppler library.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base classes.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Load the PDF document with the Poppler library.</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">popplerqt4</span><span class="o">.</span><span class="n">Poppler</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s">&#39;demos/pyqt-whitepaper-a4.pdf&#39;</span><span class="p">)</span>

        <span class="c"># Enable antialiasing to improve the readability of the fonts.</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">setRenderHint</span><span class="p">(</span><span class="n">popplerqt4</span><span class="o">.</span><span class="n">Poppler</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">Antialiasing</span><span class="p">)</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">setRenderHint</span><span class="p">(</span><span class="n">popplerqt4</span><span class="o">.</span><span class="n">Poppler</span><span class="o">.</span><span class="n">Document</span><span class="o">.</span><span class="n">TextAntialiasing</span><span class="p">)</span>

        <span class="c"># Convert the first page to an image and install it as the</span>
        <span class="c"># pixmap of a QLabel.</span>
        <span class="n">pdf_img</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">page</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">renderToImage</span><span class="p">()</span>
        <span class="n">pdf_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLabel</span><span class="p">())</span>
        <span class="n">pdf_label</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPixmap</span><span class="o">.</span><span class="n">fromImage</span><span class="p">(</span><span class="n">pdf_img</span><span class="p">))</span>

        <span class="c"># Add a QScrollArea and place the pdf_label inside.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteScroll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QScrollArea</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteScroll</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">pdf_label</span><span class="p">)</span>

        <span class="c"># Put it all into a layout as Qtmacs will otherwise try to</span>
        <span class="c"># arrange it automatically, which is generally a bad idea when</span>
        <span class="c"># more than one widget is involved.</span>
        <span class="n">hbox</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">hbox</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteScroll</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">hbox</span><span class="p">)</span>

        <span class="c"># Connect two macros to the scroll area, one for scrolling</span>
        <span class="c"># down, one for scrolling up.</span>
        <span class="n">down</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">ScrollDown</span><span class="p">)</span>
        <span class="n">up</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">ScrollUp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+n&#39;</span><span class="p">,</span> <span class="n">down</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteScroll</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+p&#39;</span><span class="p">,</span> <span class="n">up</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteScroll</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ScrollDown</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scroll the QScrollArea down by 10%.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoPDFViewer&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QScrollArea&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">bar</span><span class="o">.</span><span class="n">maximum</span><span class="p">())</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ScrollUp</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scroll the QScrollArea up by 10%.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;DemoPDFViewer&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QScrollArea&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.1</span> <span class="o">*</span> <span class="n">bar</span><span class="o">.</span><span class="n">maximum</span><span class="p">())</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>


<span class="c"># Register the applet and create an instance thereof.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">DemoPDF</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The other features implemented by the <a class="reference external" href="http://doc.qt.digia.com/qq/qq27-poppler.html">Qt developers</a> can be implemented
likewise, including the highlighted search feature, but it is not shown
here. Together with Qtmacs macros it would then be possible to search
PDF documents like text files, quite possibly even with regular
expressions.</p>
</div>
</div>
</div>
<div class="section" id="signatures">
<span id="id4"></span><h2>Signatures<a class="headerlink" href="#signatures" title="Permalink to this headline">¶</a></h2>
<p>The previous tutorial showed how to manipulate the <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> widget
in an applet via the <tt class="docutils literal"><span class="pre">qteWidget</span></tt> reference. To this end the macro
<em>assumed</em> that <tt class="docutils literal"><span class="pre">qteWidget</span></tt> points to a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> but this need not
be the case. For instance, if the macro was executed
inside an empty applet, then <tt class="docutils literal"><span class="pre">qteWidget</span></tt> would have been <strong>None</strong> and
accessing <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> related methods impossible (Qtmacs would abort
the macro and log an error message).</p>
<p>Qtmacs provides two general remedies to this problem:</p>
<ol class="arabic simple">
<li>Applet- and widget specific key-bindings,</li>
<li>Signatures.</li>
</ol>
<p>The first does what it says: instead of <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyGlobal</span></tt></a>, which
updates the key maps of every widget in every applet, the bindings can
be targeted to either all the widgets inside a particular applet instance
(<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyApplet" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyApplet"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyApplet</span></tt></a>), or individual widgets
(<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyWidget" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyWidget</span></tt></a>).</p>
<p>The second option are <em>Signatures</em>, which are a non-empty string. The
following rules apply:</p>
<ol class="arabic simple">
<li>every applet has a signature (defaults to its class name, eg. <tt class="docutils literal"><span class="pre">MyApplet</span></tt>),</li>
<li>every widget has a signature (defaults to its class name,
eg. <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a>),</li>
<li>every macro must specify the applet- and widget signatures it is
compatible with,</li>
<li>Qtmacs will only run the macro if it is compatible with the active applet
and widget.</li>
</ol>
<p>The default signatures of applets and macros can be redefined whereas
macros <em>must</em> specify the compatible signatures explicitly with
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_macro.QtmacsMacro.qteSetAppletSignature" title="qtmacs.base_macro.QtmacsMacro.qteSetAppletSignature"><tt class="xref py py-mod docutils literal"><span class="pre">qteSetAppletSignature</span></tt></a> and <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_macro.QtmacsMacro.qteSetWidgetSignature" title="qtmacs.base_macro.QtmacsMacro.qteSetWidgetSignature"><tt class="xref py py-mod docutils literal"><span class="pre">qteSetWidgetSignature</span></tt></a> in their
constructors &#8211; there is no default. If the macro constructor fails to do
so then Qtmacs will refuse to register it.</p>
<p>The previous tutorials already did this because the macro constructors
were always:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">QtmacsMacro</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">*</span></tt> signature is the only one with a special meaning and states
that this macro is compatible with every applet and every
widget.</p>
<p>To experiment with the concept we will first create an example applet
featuring three <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a> components and a macro to insert a
pre-defined text. The applet uses the same concepts as the <a class="reference internal" href="#simpleeditor"><em>text
editor example</em></a> and some may prefer to <a class="reference internal" href="#widgetspecifickeybindings"><em>skip it</em></a>.</p>
<p>Start by creating a file called &#8220;tut_3.py&#8221; and populate it with:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 3: Applet- and macro signatures.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMulti</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with multiple widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Instantiate three QLineEdit objects.</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line3</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Register them with Qtmacs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">widgetSignature</span><span class="o">=</span><span class="s">&#39;custom&#39;</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs, create an instance of it, and display it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialMulti</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Then start Qtmacs with</p>
<div class="highlight-bash"><div class="highlight"><pre>./qtmacs.py --load tut_3.py
</pre></div>
</div>
<p id="sigexamplewidgetdefault">This applet creates three <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a> instances and puts them under
the control of Qtmacs (ie. calls <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet.qteAddWidget" title="qtmacs.base_applet.QtmacsApplet.qteAddWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteAddWidget</span></tt></a> on them). Their
behaviour is as follows:</p>
<ul class="simple">
<li>The left widget responds to alphanumeric keys as usual,</li>
<li>the middle widget does not respond to any key,</li>
<li>the right widget also does not respond to any key.</li>
</ul>
<p>Here is why: the left widget was registered without any parameters to
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet.qteAddWidget" title="qtmacs.base_applet.QtmacsApplet.qteAddWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteAddWidget</span></tt></a> and its widget signature is therefore
&#8220;QLineEdit&#8221;. Qtmacs will recognise this signature and install the
default macros and key bindings for it.</p>
<p>The second widget also has a &#8220;QLineEdit&#8221; signature but Qtmacs will not
install any default macros because of the <tt class="docutils literal"><span class="pre">autoBind=False</span></tt> argument
given to <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet.qteAddWidget" title="qtmacs.base_applet.QtmacsApplet.qteAddWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteAddWidget</span></tt></a>. Consequently, no macros are associated with the
widget and it is therefore unresponsive.</p>
<p>The right widget is manually assigned the signature &#8220;custom&#8221;. Qtmacs
will not recognise this signature and consequently also not install any
key-bindings for it. The effect is the same as for the middle widget.</p>
<p>The result is an applet that looks like this (after typing some
characters into the leftmost <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a>):</p>
<div class="figure align-center">
<img alt="_images/tut_3_1.png" src="_images/tut_3_1.png" style="width: 700px;" />
<p class="caption">An applet with three <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a> widgets.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can cycle the focus with <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span> <span class="pre">o</span></tt>.</p>
</div>
<p>In the next step we will add a macro called <tt class="docutils literal"><span class="pre">DemoMacroLineEdit</span></tt> which
inserts the text &#8220;|LineEdit|&#8221; on demand. Its constructor declares
itself compatible with every <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QlineEdit</a> and every applet, and is
bound to the <tt class="docutils literal"><span class="pre">e</span></tt>-key.</p>
<div class="highlight-python" id="codesnippet-tut-3-2"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 3: Applet- and macro signatures.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMulti</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with multiple widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Instantiate three QLineEdit objects.</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line3</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Register them with Qtmacs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">widgetSignature</span><span class="o">=</span><span class="s">&#39;custom&#39;</span><span class="p">)</span>


<span class="hll"><span class="k">class</span> <span class="nc">DemoMacroLineEdit</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Insert the typed key, followed by a &#39;|&#39; character, into a QLineEdit.</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    |Signature|</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    * *applet*: &#39;*&#39;</span>
</span><span class="hll"><span class="sd">    * *widget*: &#39;QLineEdit&#39;</span>
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QLineEdit&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;|LineEdit|&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="c"># Register the applet with Qtmacs and create an instance of it.</span>
</span><span class="hll"><span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialMulti</span><span class="p">)</span>
</span><span class="hll"><span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="c"># Register the macro and bind it to the &#39;e&#39; key.</span>
</span><span class="hll"><span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">DemoMacroLineEdit</span><span class="p">)</span>
</span><span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="c"># Make the applet active.</span>
</span><span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>The effect on the three <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a> widgets is as follows:</p>
<ul class="simple">
<li>The left <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a> responds as usual except to <tt class="docutils literal"><span class="pre">e</span></tt> which now
inserts &#8220;|LineEdit|&#8221;, not &#8220;e&#8221;,</li>
<li>the middle <cite>QLineEdit</cite> responds likewise, but is otherwise still
unresponsive,</li>
<li>the right <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a> still does not respond to anything, including
<tt class="docutils literal"><span class="pre">e</span></tt>.</li>
</ul>
<p>In summary, only the first two widgets are affected because both their
signatures are &#8220;QLineEdit&#8221;. The third widget, on the other
hand, has the signature &#8220;custom&#8221; (see Line 31) and Qtmacs therefore
refuses to execute the macro.</p>
<div class="figure align-center">
<img alt="_images/tut_3_2.png" src="_images/tut_3_2.png" style="width: 700px;" />
<p class="caption">An applet with three <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a> widgets.</p>
</div>
<p>In the same manner, if Line 46 changes to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;custom&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>then the first two line edits will not respond to <tt class="docutils literal"><span class="pre">e</span></tt> at all (because
their signatures are not compatible with the macro) , but the third line
edit will respond because it <em>is</em> now compatible with the macro.</p>
<p>Another option is to change the line to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>which makes the macro compatible with every widgets and all three
widgets will respond to the <tt class="docutils literal"><span class="pre">e</span></tt> key, whereas the Line:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;foo&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>will make all three widgets unresponsive to <tt class="docutils literal"><span class="pre">e</span></tt> because none has a
&#8220;foo&#8221; signature.</p>
<div class="section" id="widget-specific-key-bindings">
<span id="widgetspecifickeybindings"></span><h3>Widget specific key bindings<a class="headerlink" href="#widget-specific-key-bindings" title="Permalink to this headline">¶</a></h3>
<p>Probably the easiest way to endow a particular widget with a particular
macro is to use <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyWidget" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyWidget</span></tt></a>.</p>
<p>The <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyWidget" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyWidget</span></tt></a> is straightforward to use. Here is an
example:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 3: Applet- and macro signatures.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMulti</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with multiple widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Instantiate three QLineEdit objects.</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line3</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Register them with Qtmacs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">widgetSignature</span><span class="o">=</span><span class="s">&#39;custom&#39;</span><span class="p">)</span>

<span class="hll">        <span class="c"># Register the macro and connect the ``clicked`` signals of</span>
</span><span class="hll">        <span class="c"># the push buttons.</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">macroName</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">DemoMacroLineEdit</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="c"># Bind the &#39;e&#39; key to all widgets.</span>
</span><span class="hll">        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteLine1</span><span class="p">)</span>
</span><span class="hll">        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteLine2</span><span class="p">)</span>
</span><span class="hll">        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteLine3</span><span class="p">)</span>
</span>

<span class="k">class</span> <span class="nc">DemoMacroLineEdit</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the string &#39;|LineEdit|` into a QLineEdit.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;QLineEdit&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QLineEdit&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;|LineEdit|&#39;</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs, create an instance of it,</span>
<span class="c"># and make it active immediately.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialMulti</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The only change compared to the <a class="reference internal" href="#codesnippet-tut-3-2"><em>previous program</em></a> is that the registration and binding of the macro
now happens in the class constructor, instead of outside the class at
the end of the file.</p>
<p>The <a class="reference internal" href="#sigexamplewidgetdefault"><em>original behaviour</em></a> of the three
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a> widgets has now changed to:</p>
<ul class="simple">
<li>The left widgets reacts to alphanumerical keys as usual except
<tt class="docutils literal"><span class="pre">e</span></tt>, which now triggers our new macro.</li>
<li>The middle widget does not react to any key except <tt class="docutils literal"><span class="pre">e</span></tt>, which also
triggers our new macro.</li>
<li>The right widget does not react to anything, <em>including</em> <tt class="docutils literal"><span class="pre">e</span></tt>.</li>
</ul>
<p>The first two behaviours are expected because we explicitly bound the
macro to them. The right widget, on the other hand, does not respond
because it has the signature &#8220;custom&#8221; whereas the <tt class="docutils literal"><span class="pre">DemoMacroLineEdit</span></tt>
macro declared itself only compatible with &#8220;QLineEdit&#8221; signatures, not
with the &#8220;custom&#8221; signature.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The signature rules still apply when using
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyWidget" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyWidget</span></tt></a>, ie. binding an incompatible
macro to a widget is admissible, but the macro will never be
executed.</p>
</div>
</div>
<div class="section" id="applet-specific-key-bindings">
<h3>Applet specific key bindings<a class="headerlink" href="#applet-specific-key-bindings" title="Permalink to this headline">¶</a></h3>
<p>So far, we have only used macros that are compatible with every applet,
ie. they used:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>in their constructor. To confine macros to specific applets we may
change this to:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;TutorialMulti&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If we now use the <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyGlobal</span></tt></a> function it will still bind the
macro to <em>every</em> widget in <em>every</em> applet, but only execute it for the
widgets inside our <cite>TutorialMultiApplet</cite> applet. Outside our applet the
bound key sequence will do <em>nothing</em>, <em>particularly also not executing
the original macro bound before the key was bound</em>. For this reason,
macros should never be bound globally unless they perform applet
independent tasks, eg. split the window, switch to the next applet, or
shutdown Qtmacs.</p>
<p>A more elegant solution is to either use <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyWidget" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyWidget"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyWidget</span></tt></a> as
in the previous section or use <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyApplet" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyApplet"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyApplet</span></tt></a>. The latter works
exactly like <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal" title="qtmacs.qtmacsmain.QtmacsMain.qteBindKeyGlobal"><tt class="xref py py-mod docutils literal"><span class="pre">qteBindKeyGlobal</span></tt></a> but only affects the key-maps of the
widgets inside a particular applet <em>instance</em>, ie. multiple instances of
the same applet can still have different key bindings. Since only the
key maps in our applet are affected it does not matter if the macro
declares itself universally compatible (&#8220;*&#8221;) or just with
&#8220;TutorialMulti&#8221;.</p>
<p>Here is an example:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 3: Applet- and macro signatures.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMulti</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with multiple widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Instantiate three QLineEdit objects.</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line3</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Register them with Qtmacs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">widgetSignature</span><span class="o">=</span><span class="s">&#39;custom&#39;</span><span class="p">)</span>

        <span class="c"># Register the macro and bind it to the &#39;e&#39; key for all</span>
        <span class="c"># widgets currently registered in this class.</span>
<span class="hll">        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">DemoMacroLineEdit</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyApplet</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span>

<span class="k">class</span> <span class="nc">DemoMacroLineEdit</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the typed key, followed by a &#39;|&#39; character, into a QLineEdit.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;QLineEdit&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QLineEdit&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;|LineEdit|&#39;</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs and create an instance of it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialMulti</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>

<span class="c"># Make the applet active.</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The overall behaviour of the code inside our applet has not changed at
all, and the signature scenarios from above will also behave the
same. What <em>is</em> different is that the <tt class="docutils literal"><span class="pre">e</span></tt> key in all other applets is
not affected. To test this more explicitly we add two push buttons;
the first to bind keys globally, the second to bind them locally:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 3: Applet- and macro signatures.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMulti</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with multiple widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Instantiate three QLineEdit objects.</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line3</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Register them with Qtmacs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">widgetSignature</span><span class="o">=</span><span class="s">&#39;custom&#39;</span><span class="p">)</span>

        <span class="c"># Instantiate and register two push buttons.</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBLocal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBGlobal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBLocal</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;Local&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBGlobal</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;Global&#39;</span><span class="p">)</span>
</span>

<span class="k">class</span> <span class="nc">DemoMacroLineEdit</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the typed key, followed by a &#39;|&#39; character, into a QLineEdit.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;QLineEdit&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QLineEdit&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;|LineEdit|&#39;</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs and create an instance of it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialMulti</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>

<span class="c"># Make the applet active.</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The push buttons react to mouse clicks but not keyboard events (we will
fix this shortly).</p>
<p>As in any other Qt program, we can now connect to the <tt class="docutils literal"><span class="pre">clicked</span></tt>
signals to callback routines. These routines, in turn, will bind the
macros either locally or globally, depending on which button was pressed:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 3: Applet- and macro signatures.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMulti</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with multiple widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Instantiate three QLineEdit objects.</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line3</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Register them with Qtmacs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">widgetSignature</span><span class="o">=</span><span class="s">&#39;custom&#39;</span><span class="p">)</span>

        <span class="c"># Instantiate and register two push buttons.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBLocal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBGlobal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBLocal</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;Local&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBGlobal</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;Global&#39;</span><span class="p">)</span>

<span class="hll">        <span class="c"># Register the macro and connect the ``clicked`` signals of</span>
</span><span class="hll">        <span class="c"># the push buttons.</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">macroName</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">DemoMacroLineEdit</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBGlobal</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clickedGlobal</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBLocal</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clickedLocal</span><span class="p">)</span>
</span>
    <span class="k">def</span> <span class="nf">clickedGlobal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroName</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clickedLocal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyApplet</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DemoMacroLineEdit</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the typed key, followed by a &#39;|&#39; character, into a QLineEdit.</span>

<span class="sd">    | Signature |</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;QLineEdit&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QLineEdit&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;|LineEdit|&#39;</span><span class="p">)</span>


<span class="hll"><span class="c"># Register the applet with Qtmacs and create an instance of it.</span>
</span><span class="hll"><span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialMulti</span><span class="p">)</span>
</span><span class="hll"><span class="n">app_obj1</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
</span><span class="hll"><span class="n">app_obj2</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll"><span class="c"># Make the applet active, split its layout, and show the second</span>
</span><span class="hll"><span class="c"># applet in the other half.</span>
</span><span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj1</span><span class="p">)</span>
</span><span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteSplitApplet</span><span class="p">(</span><span class="n">app_obj2</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<div class="figure align-center">
<img alt="_images/tut_3_5.png" src="_images/tut_3_5.png" style="width: 700px;" />
<p class="caption">Two instances of the applet side by side.</p>
</div>
<p>This code will register the macro inside the constructor, create two
applet instances, and show them side by side (Lines 70-78) for ease of
use.</p>
<p>Now we can experiment by switching between the two applets with
<tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span> <span class="pre">o</span></tt> and cycle through their widgets and buttons
with <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span> <span class="pre">&lt;ctrl&gt;+o</span></tt>.</p>
<p>The last extension to the program is to make the buttons clickable again
with the keyboard. This has nothing to do with signatures and macro
bindings and is for convenience only.</p>
<p>Every <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qpushbutton.html">QPushButton</a> has a method called <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qabstractbutton.html#animateClick">animateClick</a> which allows
to click a button programmatically. To make our button clickable with
<tt class="docutils literal"><span class="pre">&lt;space&gt;</span></tt> all we need is a macro that calls that method.</p>
<div class="highlight-python" id="usekeypressevent"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 3: Applet- and macro signatures.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMulti</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with multiple widgets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Instantiate three QLineEdit objects.</span>
        <span class="n">line1</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line2</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">line3</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="c"># Register them with Qtmacs.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line2</span><span class="p">,</span> <span class="n">autoBind</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteLine3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">line3</span><span class="p">,</span> <span class="n">widgetSignature</span><span class="o">=</span><span class="s">&#39;custom&#39;</span><span class="p">)</span>

        <span class="c"># Instantiate and register two push buttons.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBLocal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBGlobal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBLocal</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;Local&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBGlobal</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;Global&#39;</span><span class="p">)</span>

<span class="hll">        <span class="c"># Register the macro and connect the ``clicked`` signals of</span>
</span><span class="hll">        <span class="c"># the push buttons.</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">macroName</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">DemoMacroLineEdit</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBGlobal</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clickedGlobal</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qtePBLocal</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clickedLocal</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">        <span class="c"># Register DemoClickTheButton and bind it to &lt;space&gt;.</span>
</span><span class="hll">        <span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">DemoClickTheButton</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyApplet</span><span class="p">(</span><span class="s">&#39;&lt;space&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
</span>
    <span class="k">def</span> <span class="nf">clickedGlobal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroName</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clickedLocal</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyApplet</span><span class="p">(</span><span class="s">&#39;e&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">DemoMacroLineEdit</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the typed key, followed by a &#39;|&#39; character, into a QLineEdit.</span>

<span class="sd">    | Signature |</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;QLineEdit&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QLineEdit&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;|LineEdit|&#39;</span><span class="p">)</span>


<span class="hll"><span class="k">class</span> <span class="nc">DemoClickTheButton</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Pass the last key on to the Qt native ``keyPressEvent`` method of</span>
</span><span class="hll"><span class="sd">    the active widget.</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    |Signature|</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    * *applet*: &#39;DemoMultiWidget&#39;</span>
</span><span class="hll"><span class="sd">    * *widget*: &#39;QPushButton&#39;</span>
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QPushButton&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">animateClick</span><span class="p">()</span>
</span><span class="hll">
</span>
<span class="c"># Register the applet with Qtmacs and create an instance of it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialMulti</span><span class="p">)</span>
<span class="n">app_obj1</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">app_obj2</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>

<span class="c"># Make the applet active, split its layout, and show the second</span>
<span class="c"># applet in the other half.</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj1</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteSplitApplet</span><span class="p">(</span><span class="n">app_obj2</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>The buttons can now be clicked with <tt class="docutils literal"><span class="pre">&lt;space&gt;</span></tt> which allows for
mouse-free experimentation.</p>
</div>
<div class="section" id="macros-with-same-name">
<h3>Macros with same Name<a class="headerlink" href="#macros-with-same-name" title="Permalink to this headline">¶</a></h3>
<p>Signatures facilitate the coexistence of macros with the same name but
different signature targets. The most prominent example is the <tt class="docutils literal"><span class="pre">self-insert</span></tt>
macro to insert characters. Since the implementation differs depending
on whether the character should be inserted into a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a>, a
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a>, a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qwebview.html">QWebView</a>, etc., there are individual versions for
each, yet all have the <em>same</em> name and are bound to the <em>same</em>
key. Where they differ is in the signature compatibility specified by their
constructors. For instance, the constructors of the <tt class="docutils literal"><span class="pre">self-insert</span></tt> macros
for a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a> and <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a> (defined in
&#8220;qtmacs/extensions/qtmacstextedit_macros.py&#8221; and
&#8220;qtmacs/extensions/qlineedit_macros.py&#8221;) directories are:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SelfInsert</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QtmacsMacro</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QTextEdit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SelfInsert</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QtmacsMacro</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QLineEdit&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Both macros have the same name, neither cares about the
applet (hence the <tt class="docutils literal"><span class="pre">*</span></tt>), but they target different widget signatures.</p>
<p>When the user presses a key then Qtmacs will determine the associated
macro name and, secondly, query their compatible signatures as specified
in their constructors. Finally, Qtmacs will pick the best macro in the
following order:</p>
<ol class="arabic simple">
<li>Applet- and widget signature both match.</li>
<li>Widget signature matches, applet signature is &#8220;*&#8221;.</li>
<li>Applet signature matches, widget signature is &#8220;*&#8221;.</li>
<li>Applet- and widget signature are both &#8220;*&#8221;.</li>
</ol>
<p>If none of the macros meets any of the above criteria, then no macro is
executed and Qtmacs logs a message that no compatible macro is available.</p>
</div>
</div>
<div class="section" id="mini-applets">
<h2>Mini Applets<a class="headerlink" href="#mini-applets" title="Permalink to this headline">¶</a></h2>
<p>Creating a mini-applet is no different from creating any other
<a class="reference internal" href="#appletdev"><em>applet</em></a> because both are sub-classes of
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet" title="qtmacs.base_applet.QtmacsApplet"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsApplet</span></tt></a>. The behaviour is slightly different, though, because
mini-applets are</p>
<ul class="simple">
<li>displayed beneath the status applet,</li>
<li>automatically removed when the user hits <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+g</span></tt>,</li>
<li>installed with <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteAddMiniApplet" title="qtmacs.qtmacsmain.QtmacsMain.qteAddMiniApplet"><tt class="xref py py-mod docutils literal"><span class="pre">qteAddMiniApplet</span></tt></a> instead of <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteNewApplet" title="qtmacs.qtmacsmain.QtmacsMain.qteNewApplet"><tt class="xref py py-mod docutils literal"><span class="pre">qteNewApplet</span></tt></a>,</li>
<li>(usually) not registered with Qtmacs (ie. <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteRegisterApplet" title="qtmacs.qtmacsmain.QtmacsMain.qteRegisterApplet"><tt class="xref py py-mod docutils literal"><span class="pre">qteRegisterApplet</span></tt></a> is not
required prior to use),</li>
<li>and only one mini-applet can be active at any given time (even if
Qtmacs has multiple windows).</li>
</ul>
<p>The typical use case for mini-applets is to query for input, which is
why they are often comprised of a <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a> or <a class="reference external" href="http://qt-project.org/doc/qt-4.8/QTextEdit.html">QTextEdit</a>. However,
they may also contain any other widgets and perform tasks unrelated to
input queries.</p>
<p>In the first part of this tutorial we will implement a mini-applet from
scratch, namely a simple <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a> query that displays the entered
text in the status applet. The second part will leverage the power of
object oriented programming and implement the same query with less code
and more features using the pre-defined <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery"><tt class="xref py py-mod docutils literal"><span class="pre">MiniAppletBaseQuery</span></tt></a>. This
class provides both a history and an auto-completion feature, and
furnishes many of the standard queries seen elsewhere in Qtmacs, for
instance <tt class="docutils literal"><span class="pre">execute-macro</span></tt> (<tt class="docutils literal"><span class="pre">&lt;alt&gt;+x</span></tt>) or <tt class="docutils literal"><span class="pre">new-applet</span></tt> (<tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span>
<span class="pre">&lt;ctrl&gt;+a</span></tt>).</p>
<div class="section" id="a-mini-applet-from-scratch">
<h3>A Mini-Applet from Scratch<a class="headerlink" href="#a-mini-applet-from-scratch" title="Permalink to this headline">¶</a></h3>
<p>To implement a query we need to sub-class <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.base_applet.QtmacsApplet" title="qtmacs.base_applet.QtmacsApplet"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsApplet</span></tt></a>, add a
<a class="reference external" href="http://qt-project.org/doc/qt-4.8/qlineedit.html">QLineEdit</a>, and re-bind the <tt class="docutils literal"><span class="pre">&lt;enter&gt;</span></tt> key to display the entered
text in the status applet. To emphasise that mini-applets are like
normal <a class="reference internal" href="#appletdev"><em>applets</em></a> we will develop it as such first and
only afterwards turn it into a mini-applet.</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 8: an applet with a ``QLineEdit`` that displays its content</span>
<span class="sd">            in the status applet whenever the user hits &lt;enter&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMiniApplet</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with a ``QLineEdit``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QLineEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="c"># Register our macro and let it handle the &lt;return&gt; key for</span>
        <span class="c"># the QTextEdit widget.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">InputComplete</span><span class="p">)</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InputComplete</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the content from the ``QLineEdit`` and display it in the</span>
<span class="sd">    status applet.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;TutorialMiniApplet&#39;</span>
<span class="sd">    * *widget*: &#39;QLineEdit&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;TutorialMiniApplet&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QLineEdit&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteStatus</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>


<span class="c"># Register the applet with Qtmacs, create an instance of it, and</span>
<span class="c"># display it.</span>
<span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialMiniApplet</span><span class="p">)</span>
<span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="figure align-center">
<img alt="_images/tut_8_1.png" src="_images/tut_8_1.png" style="width: 700px;" />
<p class="caption">A simple query applet that displays its text in the status applet.</p>
</div>
<p>The next step is to spawn this applet with a keyboard sequence instead
of automatically at startup. To do this we move lines 57-59 into a
macro which we bind to a key-sequence (<tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span> <span class="pre">q</span></tt>, in this example).</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 8: an applet with a ``QLineEdit`` that displays its content</span>
<span class="sd">            in the status applet whenever the user hits &lt;enter&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMiniApplet</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with a ``QLineEdit``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QLineEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="c"># Register our macro and let it handle the &lt;return&gt; key for</span>
        <span class="c"># the QTextEdit widget.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">InputComplete</span><span class="p">)</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InputComplete</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the content from the ``QLineEdit`` and display it in the</span>
<span class="sd">    status applet.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;TutorialMiniApplet&#39;</span>
<span class="sd">    * *widget*: &#39;QLineEdit&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;TutorialMiniApplet&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QLineEdit&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteStatus</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>


<span class="hll"><span class="k">class</span> <span class="nc">SpawnTutorialMiniApplet</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Register- and instantiate ``TutorialMiniApplet``.</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    |Signature|</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    * *applet*: &#39;*&#39;</span>
</span><span class="hll"><span class="sd">    * *widget*: &#39;*&#39;</span>
</span><span class="hll">
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class="hll">        <span class="c"># Register the applet with Qtmacs, create an instance of it,</span>
</span><span class="hll">        <span class="c"># and display it.</span>
</span><span class="hll">        <span class="n">app_name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterApplet</span><span class="p">(</span><span class="n">TutorialMiniApplet</span><span class="p">)</span>
</span><span class="hll">        <span class="n">app_obj</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteNewApplet</span><span class="p">(</span><span class="n">app_name</span><span class="p">)</span>
</span><span class="hll">        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteMakeAppletActive</span><span class="p">(</span><span class="n">app_obj</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">
</span><span class="hll"><span class="c"># Register ``SpawnTutorialMiniApplet`` and bind it to a key.</span>
</span><span class="hll"><span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">SpawnTutorialMiniApplet</span><span class="p">)</span>
</span><span class="hll"><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+x q&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
<p>Once Qtmacs has loaded, we are now able to instantiate the applet with
the <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span> <span class="pre">q</span></tt> shortcut.</p>
<p>The last step is to turn this applet into a mini-applet. Recall that
mini-applets need not be registered with Qtmacs. Instead, they are
instantiated directly and installed with the <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteAddMiniApplet" title="qtmacs.qtmacsmain.QtmacsMain.qteAddMiniApplet"><tt class="xref py py-mod docutils literal"><span class="pre">qteAddMiniApplet</span></tt></a> method
as shown below:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 8: an applet with a ``QLineEdit`` that displays its content</span>
<span class="sd">            in the status applet whenever the user hits &lt;enter&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMiniApplet</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with a ``QLineEdit``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QLineEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="c"># Register our macro and let it handle the &lt;return&gt; key for</span>
        <span class="c"># the QTextEdit widget.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">InputComplete</span><span class="p">)</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InputComplete</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the content from the ``QLineEdit`` and display it in the</span>
<span class="sd">    status applet.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;TutorialMiniApplet&#39;</span>
<span class="sd">    * *widget*: &#39;QLineEdit&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;TutorialMiniApplet&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QLineEdit&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteStatus</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SpawnTutorialMiniApplet</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register- and instantiate ``TutorialMiniApplet``.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Create an instance of the applet. Note: there is no need to</span>
        <span class="c"># register this applet with Qtmacs.</span>
<span class="hll">        <span class="n">obj</span> <span class="o">=</span> <span class="n">TutorialMiniApplet</span><span class="p">(</span><span class="s">&#39;__MiniApplet__&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="n">app_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteAddMiniApplet</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
</span>

<span class="c"># Register ``SpawnTutorialMiniApplet`` and bind it to a key.</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">SpawnTutorialMiniApplet</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+x q&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="figure align-center">
<img alt="_images/tut_8_3.png" src="_images/tut_8_3.png" style="width: 700px;" />
<p class="caption">The query-applet as a mini-applet.</p>
</div>
<p>If we now press <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span> <span class="pre">q</span></tt> the applet will appear at the bottom,
which is where all mini applets appear.</p>
<p>The only shortcoming with this mini-applet is that it does not destroy
itself after pressing <tt class="docutils literal"><span class="pre">&lt;enter&gt;</span></tt> which leaves <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+g</span></tt> as the only
means to remove it. Before we fix this note that it is impossible to
open another mini-applet like <tt class="docutils literal"><span class="pre">execute-macro</span></tt> (<tt class="docutils literal"><span class="pre">&lt;alt&gt;+x</span></tt>) for as
long as our mini-applet is shown. Note further that the mini-applet
behaves like any other applet in all other respects. For instance,
<tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span> <span class="pre">o</span></tt> still cycles the focus and eg. <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span> <span class="pre">3</span></tt> still
splits the conventional applets vertically.</p>
<p>To automatically close the mini-applet when the user hits <tt class="docutils literal"><span class="pre">&lt;enter&gt;</span></tt> we
call <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteKillMiniApplet" title="qtmacs.qtmacsmain.QtmacsMain.qteKillMiniApplet"><tt class="xref py py-mod docutils literal"><span class="pre">qteKillMiniApplet</span></tt></a>:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 8: an applet with a ``QLineEdit`` that displays its content</span>
<span class="sd">            in the status applet whenever the user hits &lt;enter&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMiniApplet</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with a ``QLineEdit``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QLineEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="c"># Register our macro and let it handle the &lt;return&gt; key for</span>
        <span class="c"># the QTextEdit widget.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">InputComplete</span><span class="p">)</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">InputComplete</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Read the content from the ``QLineEdit`` and display it in the</span>
<span class="sd">    status applet.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;TutorialMiniApplet&#39;</span>
<span class="sd">    * *widget*: &#39;QLineEdit&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;TutorialMiniApplet&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QLineEdit&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteStatus</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteKillMiniApplet</span><span class="p">()</span>
</span>

<span class="k">class</span> <span class="nc">SpawnTutorialMiniApplet</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register- and instantiate ``TutorialMiniApplet``.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Create an instance of the applet. Note: there is no need to</span>
        <span class="c"># register this applet with Qtmacs.</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TutorialMiniApplet</span><span class="p">(</span><span class="s">&#39;__MiniApplet__&#39;</span><span class="p">)</span>
        <span class="n">app_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteAddMiniApplet</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>


<span class="c"># Register ``SpawnTutorialMiniApplet`` and bind it to a key.</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">SpawnTutorialMiniApplet</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+x q&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Now we have a fully functional mini-applet.</p>
</div>
<div class="section" id="default-queries">
<h3>Default Queries<a class="headerlink" href="#default-queries" title="Permalink to this headline">¶</a></h3>
<p>One advantage of the object oriented design of Qt and Qtmacs is to
provide template classes for common tasks. For instance, the
<tt class="docutils literal"><span class="pre">miniapplets</span></tt> directory contains a <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery"><tt class="xref py py-mod docutils literal"><span class="pre">MiniAppletBaseQuery</span></tt></a> and
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.file_query.MiniAppletFindFile" title="qtmacs.miniapplets.file_query.MiniAppletFindFile"><tt class="xref py py-mod docutils literal"><span class="pre">MiniAppletFindFile</span></tt></a> class in <cite>base_query.py</cite> and <cite>file_query.py</cite>,
respectively. The former implements the very mini-applet discussed
before, complete with history and <tt class="docutils literal"><span class="pre">&lt;tab&gt;</span></tt>-completion, whereas
the latter is for finding and opening files (also with
<tt class="docutils literal"><span class="pre">&lt;tab&gt;</span></tt>-completion and history).</p>
<p>This section only makes use of <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery"><tt class="xref py py-mod docutils literal"><span class="pre">MiniAppletBaseQuery</span></tt></a> but an
example for how to use <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.file_query.MiniAppletFindFile" title="qtmacs.miniapplets.file_query.MiniAppletFindFile"><tt class="xref py py-mod docutils literal"><span class="pre">MiniAppletFindFile</span></tt></a> it is available in its
<a class="reference internal" href="qtmacs_autodoc.html#module-qtmacs.miniapplets.file_query" title="qtmacs.miniapplets.file_query"><tt class="xref py py-mod docutils literal"><span class="pre">module</span> <span class="pre">documentation</span></tt></a>.</p>
<p>To use <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery"><tt class="xref py py-mod docutils literal"><span class="pre">MiniAppletBaseQuery</span></tt></a> one must overload the
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery.generateCompletions" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery.generateCompletions"><tt class="xref py py-mod docutils literal"><span class="pre">generateCompletions</span></tt></a> and <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery.inputCompleted" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery.inputCompleted"><tt class="xref py py-mod docutils literal"><span class="pre">inputCompleted</span></tt></a> methods, both of which
are supplied with the currently entered text. The first of these two
methods is called when the user presses <tt class="docutils literal"><span class="pre">&lt;tab&gt;</span></tt> and must return a list
of possible auto-completion candidates. This list need not be based on
the user input as the <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery"><tt class="xref py py-mod docutils literal"><span class="pre">MiniAppletBaseQuery</span></tt></a> automatically removes all
entries that do not contain the already entered text as a sub-string. It
will also try to auto-complete as much of the entered text as possible
given the list of candidates. However, the user is free to enter an
arbitrary string, even if it is not part of the auto-completion list.</p>
<p>The second method is called when the user hits <tt class="docutils literal"><span class="pre">&lt;enter&gt;</span></tt> and must
implement the desired behaviour, for instance create an applet with the
specified name.</p>
<p>To implement our previous query applet we may thus use the
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery"><tt class="xref py py-mod docutils literal"><span class="pre">MiniAppletBaseQuery</span></tt></a> object like so:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 8: an applet with a ``QLineEdit`` that displays its content</span>
<span class="sd">            in the status applet whenever the user hits &lt;enter&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="hll"><span class="c"># Import the default query object.</span>
</span><span class="hll"><span class="kn">import</span> <span class="nn">qtmacs.miniapplets.base_query</span> <span class="kn">as</span> <span class="nn">base_query</span>
</span>
<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMiniApplet</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with a ``QLineEdit``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QLineEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="c"># Register our macro and let it handle the &lt;return&gt; key for</span>
        <span class="c"># the QTextEdit widget.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">InputComplete</span><span class="p">)</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>


<span class="hll"><span class="k">class</span> <span class="nc">Query</span><span class="p">(</span><span class="n">base_query</span><span class="o">.</span><span class="n">MiniAppletBaseQuery</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">    Demonstrate the use of ``MiniAppletBaseQuery``.</span>
</span><span class="hll"><span class="sd">    &quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">generateCompletions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userInput</span><span class="p">):</span>
</span><span class="hll">        <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">        This method is called whenever the user hits &lt;tab&gt;. The</span>
</span><span class="hll"><span class="sd">        ``userInput`` argument is the currently entered text.</span>
</span><span class="hll"><span class="sd">        &quot;&quot;&quot;</span>
</span><span class="hll">        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;Option 1&#39;</span><span class="p">,</span> <span class="s">&#39;Option 2&#39;</span><span class="p">,</span> <span class="s">&#39;Option 3&#39;</span><span class="p">,</span> <span class="s">&#39;Yes&#39;</span><span class="p">,</span> <span class="s">&#39;No&#39;</span><span class="p">]</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">inputCompleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userInput</span><span class="p">):</span>
</span><span class="hll">        <span class="sd">&quot;&quot;&quot;</span>
</span><span class="hll"><span class="sd">        This method is called whenever the user hits &lt;enter&gt;. The</span>
</span><span class="hll"><span class="sd">        ``userInput`` argument is the currently entered text.</span>
</span><span class="hll"><span class="sd">        &quot;&quot;&quot;</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteStatus</span><span class="p">(</span><span class="n">userInput</span><span class="p">)</span>
</span>

<span class="k">class</span> <span class="nc">SpawnTutorialMiniApplet</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register- and instantiate ``TutorialMiniApplet``.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="hll">        <span class="c"># Instantiate the query object and install it as the mini applet.</span>
</span><span class="hll">        <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="p">)</span>
</span><span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteAddMiniApplet</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span>

<span class="c"># Register ``SpawnTutorialMiniApplet`` and bind it to a key.</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">SpawnTutorialMiniApplet</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+x q&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Line 7 imports the necessary module and Lines 37-53 sub-class the
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery"><tt class="xref py py-mod docutils literal"><span class="pre">MiniAppletBaseQuery</span></tt></a> and reimplement the <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery.generateCompletions" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery.generateCompletions"><tt class="xref py py-mod docutils literal"><span class="pre">generateCompletions</span></tt></a> and
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery.inputCompleted" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery.inputCompleted"><tt class="xref py py-mod docutils literal"><span class="pre">inputCompleted</span></tt></a> methods. In this example the new
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery.generateCompletions" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery.generateCompletions"><tt class="xref py py-mod docutils literal"><span class="pre">generateCompletions</span></tt></a> method (executed upon <tt class="docutils literal"><span class="pre">&lt;tab&gt;</span></tt>) ignores the
user input and always provides a fixed set of possible completions,
whereas the <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery.inputCompleted" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery.inputCompleted"><tt class="xref py py-mod docutils literal"><span class="pre">inputCompleted</span></tt></a> (executed upon <tt class="docutils literal"><span class="pre">&lt;enter&gt;</span></tt>) displays the
user input in the status applet.</p>
<p>Line 73 instantiates the applet, and Line 74 installs it as the mini
applet.</p>
<p>The net effect of this implementation is that it behaves like the one
from the previous section, but requires considerably less code and has
built-in auto-completion via the <tt class="docutils literal"><span class="pre">&lt;tab&gt;</span></tt> key.</p>
<div class="figure align-center">
<img alt="_images/tut_8_5.png" src="_images/tut_8_5.png" style="width: 700px;" />
<p class="caption">The query-applet based on <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery"><tt class="xref py py-mod docutils literal"><span class="pre">MiniAppletBaseQuery</span></tt></a> with auto-completion.</p>
</div>
<p>To also add a history feature we need to provide a Python list to the
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.miniapplets.base_query.MiniAppletBaseQuery" title="qtmacs.miniapplets.base_query.MiniAppletBaseQuery"><tt class="xref py py-mod docutils literal"><span class="pre">MiniAppletBaseQuery</span></tt></a> constructor. Once the query is activated,
this list can then be traversed with <tt class="docutils literal"><span class="pre">&lt;alt&gt;+p</span></tt> and
<tt class="docutils literal"><span class="pre">&lt;alt&gt;+n</span></tt>. Furthermore, once the user hits <tt class="docutils literal"><span class="pre">&lt;enter&gt;</span></tt> the latest
input will be added to the list. To preserve the history between calls
we may store the list in the macro that created the query in the
first place. Here is a possible implementation of this approach:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre></div></td><td class="code"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Tutorial 8: an applet with a ``QLineEdit`` that displays its content</span>
<span class="sd">            in the status applet whenever the user hits &lt;enter&gt;.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c"># Import the default query object.</span>
<span class="kn">import</span> <span class="nn">qtmacs.miniapplets.base_query</span> <span class="kn">as</span> <span class="nn">base_query</span>

<span class="c"># Import the module with the global variables and the macro base</span>
<span class="c"># class.</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_applet</span> <span class="kn">import</span> <span class="n">QtmacsApplet</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtGui</span>

<span class="c"># Get a reference to the main instance of Qtmacs.</span>
<span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>


<span class="k">class</span> <span class="nc">TutorialMiniApplet</span><span class="p">(</span><span class="n">QtmacsApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An applet with a ``QLineEdit``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">appletID</span><span class="p">):</span>
        <span class="c"># Initialise the base class.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">appletID</span><span class="p">)</span>

        <span class="c"># Add a QLineEdit widget to the applet.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteAddWidget</span><span class="p">(</span><span class="n">QtGui</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>

        <span class="c"># Register our macro and let it handle the &lt;return&gt; key for</span>
        <span class="c"># the QTextEdit widget.</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">InputComplete</span><span class="p">)</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Query</span><span class="p">(</span><span class="n">base_query</span><span class="o">.</span><span class="n">MiniAppletBaseQuery</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Demonstrate the use of ``MiniAppletBaseQuery``.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">generateCompletions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userInput</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called whenever the user hits &lt;tab&gt;. The</span>
<span class="sd">        ``userInput`` argument is the currently entered text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;Option 1&#39;</span><span class="p">,</span> <span class="s">&#39;Option 2&#39;</span><span class="p">,</span> <span class="s">&#39;Option 3&#39;</span><span class="p">,</span> <span class="s">&#39;Yes&#39;</span><span class="p">,</span> <span class="s">&#39;No&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">inputCompleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userInput</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method is called whenever the user hits &lt;enter&gt;. The</span>
<span class="sd">        ``userInput`` argument is the currently entered text.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteStatus</span><span class="p">(</span><span class="n">userInput</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">SpawnTutorialMiniApplet</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Register- and instantiate ``TutorialMiniApplet``.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
<span class="hll">        <span class="bp">self</span><span class="o">.</span><span class="n">qteQueryHistory</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Item 1&#39;</span><span class="p">,</span> <span class="s">&#39;foo&#39;</span><span class="p">,</span> <span class="s">&#39;bar&#39;</span><span class="p">]</span>
</span>
    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Instantiate the query object and install it as the mini applet.</span>
<span class="hll">        <span class="n">query</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;Tutorial Query&#39;</span><span class="p">,</span>
</span><span class="hll">                      <span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qteQueryHistory</span><span class="p">)</span>
</span>        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteAddMiniApplet</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>


<span class="c"># Register ``SpawnTutorialMiniApplet`` and bind it to a key.</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">SpawnTutorialMiniApplet</span><span class="p">)</span>
<span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyGlobal</span><span class="p">(</span><span class="s">&#39;&lt;ctrl&gt;+x q&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>Line 70 creates the list and populates it with a fake history. The
additional <tt class="docutils literal"><span class="pre">prefix</span></tt> argument in Line 75 adds a custom string to the
left of the query to customise the appearance of the mini applet.</p>
</div>
</div>
<div class="section" id="signals">
<h2>Signals<a class="headerlink" href="#signals" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain" title="qtmacs.qtmacsmain.QtmacsMain"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMain</span></tt></a> class defines various Qt signal to announce certain
events, for instance when the user hits <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+g</span></tt>, when a macro is
about to execute (<tt class="docutils literal"><span class="pre">qtesigMacroStart</span></tt>) or failed to execute
(<tt class="docutils literal"><span class="pre">qtesigMacroError</span></tt>), or when a key was pressed
(<tt class="docutils literal"><span class="pre">qtesigKeypressed</span></tt>). All signals are aggregated into <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain" title="qtmacs.qtmacsmain.QtmacsMain"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMain</span></tt></a>
for easy access from within any macro or applet via their private
<tt class="docutils literal"><span class="pre">qteMain</span></tt> reference or <tt class="docutils literal"><span class="pre">qte_global.qteMain</span></tt>. Every slot is also
provided with a <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> instance that carries signal specific
information (described below) in its <tt class="docutils literal"><span class="pre">data</span></tt> attribute and the name of
the signal in the <tt class="docutils literal"><span class="pre">messengerName</span></tt> attribute.</p>
<p>All signals are triggered synchronously and the connected slots are
therefore invoked immediately. It is therefore good practice to keep the
slots simple as Qtmacs may otherwise become unresponsive.</p>
<p>As with every Qt signal it is possible &#8211; although not advisable &#8211; to
trigger them manually. In that case the programmer should know what he
is doing as various Qtmacs internal methods rely on them to synchronise
state variables.</p>
<p>Here is an example of how to use the <tt class="docutils literal"><span class="pre">qtesigMacroStart</span></tt> signal. This
code can appear anywhere, eg. the startup script, a macro, inside an
applet constructor, etc.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">qte_global</span>

<span class="k">def</span> <span class="nf">mySlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgObj</span><span class="p">):</span>
    <span class="c"># Extract some data.</span>
    <span class="n">macroName</span> <span class="o">=</span> <span class="n">msgObj</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c"># Print a message to the terminal.</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;The macro {} is about to be executed&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">macroName</span><span class="p">))</span>

<span class="c"># Connect the signal to the just defined slot.</span>
<span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qtesigMacroStart</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">mySlot</span><span class="p">)</span>
</pre></div>
</div>
<p>These signals are currently defined:</p>
<div class="section" id="qtesigabort">
<h3>qtesigAbort<a class="headerlink" href="#qtesigabort" title="Permalink to this headline">¶</a></h3>
<p>User presses <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+g</span></tt>.</p>
<p>The <tt class="docutils literal"><span class="pre">data</span></tt> field of the associated <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> is <strong>None</strong>.</p>
</div>
<div class="section" id="qtesigcloseqtmacs">
<h3>qtesigCloseQtmacs<a class="headerlink" href="#qtesigcloseqtmacs" title="Permalink to this headline">¶</a></h3>
<p>Qtmacs is about to shutdown.</p>
<p>Once all slots of this signal were executed the windows and applets will
be killed.</p>
<p>The <tt class="docutils literal"><span class="pre">data</span></tt> field of the associated <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> is <strong>None</strong>.</p>
</div>
<div class="section" id="qtesigmacrostart">
<h3>qtesigMacroStart<a class="headerlink" href="#qtesigmacrostart" title="Permalink to this headline">¶</a></h3>
<p>A macro is ready to execute.</p>
<p>The <tt class="docutils literal"><span class="pre">data</span></tt> field of the associated <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> is a tuple with
the following entries:</p>
<ul class="simple">
<li>macro name (a string)</li>
<li>reference to target widget (identical to <tt class="docutils literal"><span class="pre">qteWidget</span></tt> attribute
inside the aborted macro).</li>
</ul>
</div>
<div class="section" id="qtesigmacrofinished">
<h3>qtesigMacroFinished<a class="headerlink" href="#qtesigmacrofinished" title="Permalink to this headline">¶</a></h3>
<p>A macro was executed without throwing an exception.</p>
<p>The <tt class="docutils literal"><span class="pre">data</span></tt> field of the associated <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> is a tuple with
the following entries:</p>
<ul class="simple">
<li>macro name (a string)</li>
<li>reference to target widget (identical to <tt class="docutils literal"><span class="pre">qteWidget</span></tt> attribute
inside the aborted macro).</li>
</ul>
</div>
<div class="section" id="qtesigmacroerror">
<h3>qtesigMacroError<a class="headerlink" href="#qtesigmacroerror" title="Permalink to this headline">¶</a></h3>
<p>A macro was terminated because it raised an exception.</p>
<p>The <tt class="docutils literal"><span class="pre">data</span></tt> field of the associated <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> is a tuple with
the following entries:</p>
<ul class="simple">
<li>macro name (a string)</li>
<li>reference to target widget (identical to <tt class="docutils literal"><span class="pre">qteWidget</span></tt> attribute
inside the aborted macro).</li>
</ul>
</div>
<div class="section" id="qtesigkeypressed">
<span id="id5"></span><h3>qtesigKeypressed<a class="headerlink" href="#qtesigkeypressed" title="Permalink to this headline">¶</a></h3>
<p>A key was pressed.</p>
<p>This macro only triggers if the keyboard event targeted a widget in the
Qtmacs hierarchy. If Qtmacs runs as a standalone application then this
is always the case, but if Qtmacs is merely one widget among many inside
a bigger PyQt program, then this signal only triggers if the target was
part of the Qtmacs widget hierarchy (ie. a widget inside any of the
applets).</p>
<p>The <tt class="docutils literal"><span class="pre">data</span></tt> field of the associated <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> is a tuple with
the following entries:</p>
<ul class="simple">
<li>reference to widget that would have received the event if Qtmacs had
not intercepted it,</li>
<li>the <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qkeyevent.html">QKeyEvent</a> generated by Qtmacs.</li>
</ul>
<p>To be precise, the <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qkeyevent.html">QKeyEvent</a> is only a copy of the original event
because Qt will destroy the original once it was declared handled. It
is therefore save to keep a reference to that <a class="reference external" href="http://qt-project.org/doc/qt-4.8/qkeyevent.html">QKeyEvent</a> for later
use.</p>
</div>
<div class="section" id="qtesigkeyparsed">
<h3>qtesigKeyparsed<a class="headerlink" href="#qtesigkeyparsed" title="Permalink to this headline">¶</a></h3>
<p>Qtmacs has just parsed another key.</p>
<p>The only difference to <a class="reference internal" href="#qtesigkeypressed"><em>qtesigKeypressed</em></a> is that it ignores
standalone modifier keys, ie. <tt class="docutils literal"><span class="pre">&lt;shift&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;meta&gt;</span></tt>,
<tt class="docutils literal"><span class="pre">&lt;alt&gt;</span></tt> and <tt class="docutils literal"><span class="pre">&lt;alt</span> <span class="pre">gr&gt;</span></tt>. Equivalently, if this signal triggers then
one of the signals <a class="reference internal" href="#qtesigkeyseqcomplete"><em>qtesigKeyseqComplete</em></a>,
<a class="reference internal" href="#qtesigkeyseqpartial"><em>qtesigKeyseqPartial</em></a>, or
<a class="reference internal" href="#qtesigkeyseqinvalid"><em>qtesigKeyseqInvalid</em></a> triggers as well, and vice versa.</p>
</div>
<div class="section" id="qtesigkeyseqpartial">
<span id="id6"></span><h3>qtesigKeyseqPartial<a class="headerlink" href="#qtesigkeyseqpartial" title="Permalink to this headline">¶</a></h3>
<p>The last key is part of a yet incomplete key sequence.</p>
<p>For instance, if the user hits <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span></tt> then this signal
triggers since <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span></tt> is the first component of the shortcut
<tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span> <span class="pre">&lt;ctrl&gt;+c</span></tt> (close Qtmacs) or <tt class="docutils literal"><span class="pre">&lt;ctrl&gt;+x</span> <span class="pre">&lt;ctrl&gt;+f</span></tt>
(find-file), and possibly many more. This signal does <em>not</em> trigger upon
completion of a valid key sequence (see <a class="reference internal" href="#qtesigkeyseqcomplete"><em>qtesigKeyseqComplete</em></a>).</p>
<p>The <tt class="docutils literal"><span class="pre">data</span></tt> field of the associated <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> contains the
as yet incomplete key sequence in a <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsKeysequence" title="qtmacs.auxiliary.QtmacsKeysequence"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsKeysequence</span></tt></a> instance.</p>
</div>
<div class="section" id="qtesigkeyseqcomplete">
<span id="id7"></span><h3>qtesigKeyseqComplete<a class="headerlink" href="#qtesigkeyseqcomplete" title="Permalink to this headline">¶</a></h3>
<p>The last key completed a keyboard shortcut.</p>
<p>This signal does <em>not</em> trigger for partially completed keyboard
shortcuts (see <a class="reference internal" href="#qtesigkeyseqpartial"><em>qtesigKeyseqPartial</em></a>).</p>
<p>The <tt class="docutils literal"><span class="pre">data</span></tt> field of the associated <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> contains a
tuple with two elements:</p>
<ul class="simple">
<li>the name of the macro that will be triggered by the key sequence,</li>
<li>the key sequence in a <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsKeysequence" title="qtmacs.auxiliary.QtmacsKeysequence"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsKeysequence</span></tt></a> instance.</li>
</ul>
</div>
<div class="section" id="qtesigkeyseqinvalid">
<span id="id8"></span><h3>qtesigKeyseqInvalid<a class="headerlink" href="#qtesigkeyseqinvalid" title="Permalink to this headline">¶</a></h3>
<p>The last key does not start, continue, or finish a valid keyboard
sequence.</p>
<p>The <tt class="docutils literal"><span class="pre">data</span></tt> field of the associated <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> contains a
the invalid key sequence in a <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsKeysequence" title="qtmacs.auxiliary.QtmacsKeysequence"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsKeysequence</span></tt></a> instance.</p>
</div>
</div>
<div class="section" id="hooks">
<h2>Hooks<a class="headerlink" href="#hooks" title="Permalink to this headline">¶</a></h2>
<p>Hooks are &#8220;fire-and-forget&#8221; versions of signals to announce events of
potential interest to someone. Unlike signals, no formal variable
declarations are required prior to their use, nor is there a central
database of hooks, nor do they require dedicated <tt class="docutils literal"><span class="pre">QtCore.pySignal</span></tt>
variables that both the emitter and receiver must know about.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The hook system in Qtmacs is reminiscent of the old-style PyQt
signal mechanism that identified Qt signals purely via strings.</p>
</div>
<p>Hooks can be triggered anywhere in the code, and intercepted at any
other point in the code &#8211; no formal relationship in terms of a class-
or module hierarchy is required.</p>
<p>To trigger a hook one must decide on a name for it and call
<a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteRunHook" title="qtmacs.qtmacsmain.QtmacsMain.qteRunHook"><tt class="xref py py-mod docutils literal"><span class="pre">qteRunHook</span></tt></a> for the dispatch. The following example shows how
to trigger a hook called <cite>foohook</cite>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRunHook</span><span class="p">(</span><span class="s">&#39;foohook&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">All listeners to a hook are executed immediately.</p>
</div>
<p>To catch the <cite>foohook</cite> simply define a function (or method) with one
argument and connect it to <cite>foohook</cite> via the <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteConnectHook" title="qtmacs.qtmacsmain.QtmacsMain.qteConnectHook"><tt class="xref py py-mod docutils literal"><span class="pre">qteConnectHook</span></tt></a> method:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">fooHookHandler</span><span class="p">(</span><span class="n">msgObj</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;The hook was triggered&#39;</span><span class="p">)</span>

<span class="n">qteMain</span><span class="o">.</span><span class="n">qteConnectHook</span><span class="p">(</span><span class="s">&#39;foohook&#39;</span><span class="p">,</span> <span class="n">fooHookHandler</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There is no need to define <cite>foohook</cite> prior to using
either <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteRunHook" title="qtmacs.qtmacsmain.QtmacsMain.qteRunHook"><tt class="xref py py-mod docutils literal"><span class="pre">qteRunHook</span></tt></a> or <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteConnectHook" title="qtmacs.qtmacsmain.QtmacsMain.qteConnectHook"><tt class="xref py py-mod docutils literal"><span class="pre">qteConnectHook</span></tt></a>.</p>
</div>
<p>The <tt class="docutils literal"><span class="pre">msgObj</span></tt> variable is always a <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> instance to
deliver custom data. In the above example its data field
(ie. <tt class="docutils literal"><span class="pre">msgObj.data</span></tt>) would be <strong>None</strong> because no custom information
was supplied to <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteRunHook" title="qtmacs.qtmacsmain.QtmacsMain.qteRunHook"><tt class="xref py py-mod docutils literal"><span class="pre">qteRunHook</span></tt></a>. To do so, create a <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a>
instance and pass it to <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.qtmacsmain.QtmacsMain.qteRunHook" title="qtmacs.qtmacsmain.QtmacsMain.qteRunHook"><tt class="xref py py-mod docutils literal"><span class="pre">qteRunHook</span></tt></a> as the second argument like so:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Import the class definition of QtmacsMessage.</span>
<span class="kn">import</span> <span class="nn">qtmacs.auxiliary</span>
<span class="n">QtmacsMessage</span> <span class="o">=</span> <span class="n">qtmacs</span><span class="o">.</span><span class="n">auxiliary</span><span class="o">.</span><span class="n">QtmacsMessage</span>

<span class="c"># Generate a message object with a string and a list as</span>
<span class="c"># data elements (packed as a tuple).</span>
<span class="n">msgObj</span> <span class="o">=</span> <span class="n">QtmacsMessage</span><span class="p">((</span><span class="s">&#39;random message&#39;</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]))</span>

<span class="c"># Trigger the hook.</span>
<span class="bp">self</span><span class="o">.</span><span class="n">qteRunHook</span><span class="p">(</span><span class="s">&#39;foohook&#39;</span><span class="p">,</span> <span class="n">msgObj</span><span class="p">)</span>
</pre></div>
</div>
<p>The obvious downside of hooks is that name clashes are possible, ie. two
completely unrelated macros may both dispatch a hook called &#8220;foo&#8221; but
supply different data in the <a class="reference internal" href="qtmacs_autodoc.html#qtmacs.auxiliary.QtmacsMessage" title="qtmacs.auxiliary.QtmacsMessage"><tt class="xref py py-mod docutils literal"><span class="pre">QtmacsMessage</span></tt></a> object. Descriptive and
documented hook names should minimise this possibility, though.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="titlepage.html">
          <img class="logo" src="_static/Max.png" alt="Logo"/>
        </a></p>
  <div class="sphinxlocaltoc">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Programming Qtmacs</a><ul>
<li><a class="reference internal" href="#hello-world">Hello World</a><ul>
<li><a class="reference internal" href="#macros">Macros</a></li>
<li><a class="reference internal" href="#applets">Applets</a><ul>
<li><a class="reference internal" href="#remarks">Remarks</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#a-text-editor-qtmacs-style">A Text Editor &#8211; Qtmacs Style</a></li>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#additional-examples">Additional Examples</a><ul>
<li><a class="reference internal" href="#web-browser">Web Browser</a></li>
<li><a class="reference internal" href="#threading">Threading</a><ul>
<li><a class="reference internal" href="#threading-pitfalls">Threading Pitfalls</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pdf-viewer">PDF Viewer</a><ul>
<li><a class="reference internal" href="#compiling-popplerqt4">Compiling <cite>popplerqt4</cite></a></li>
<li><a class="reference internal" href="#pdf-viewer-applet">PDF Viewer Applet</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#signatures">Signatures</a><ul>
<li><a class="reference internal" href="#widget-specific-key-bindings">Widget specific key bindings</a></li>
<li><a class="reference internal" href="#applet-specific-key-bindings">Applet specific key bindings</a></li>
<li><a class="reference internal" href="#macros-with-same-name">Macros with same Name</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mini-applets">Mini Applets</a><ul>
<li><a class="reference internal" href="#a-mini-applet-from-scratch">A Mini-Applet from Scratch</a></li>
<li><a class="reference internal" href="#default-queries">Default Queries</a></li>
</ul>
</li>
<li><a class="reference internal" href="#signals">Signals</a><ul>
<li><a class="reference internal" href="#qtesigabort">qtesigAbort</a></li>
<li><a class="reference internal" href="#qtesigcloseqtmacs">qtesigCloseQtmacs</a></li>
<li><a class="reference internal" href="#qtesigmacrostart">qtesigMacroStart</a></li>
<li><a class="reference internal" href="#qtesigmacrofinished">qtesigMacroFinished</a></li>
<li><a class="reference internal" href="#qtesigmacroerror">qtesigMacroError</a></li>
<li><a class="reference internal" href="#qtesigkeypressed">qtesigKeypressed</a></li>
<li><a class="reference internal" href="#qtesigkeyparsed">qtesigKeyparsed</a></li>
<li><a class="reference internal" href="#qtesigkeyseqpartial">qtesigKeyseqPartial</a></li>
<li><a class="reference internal" href="#qtesigkeyseqcomplete">qtesigKeyseqComplete</a></li>
<li><a class="reference internal" href="#qtesigkeyseqinvalid">qtesigKeyseqInvalid</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hooks">Hooks</a></li>
</ul>
</li>
</ul>

  </div>
  <h4>Previous topic</h4>
  <p class="topless"><a href="applets.html"
                        title="previous chapter">Applets</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="developers.html"
                        title="next chapter">Developers</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorials.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="developers.html" title="Developers"
             >next</a> &nbsp; &nbsp;</li>
        <li class="right" >
          <a href="applets.html" title="Applets"
             >previous</a> &nbsp; &nbsp;</li>
    <li><a href="index.html">Qtmacs 0.1 documentation</a> &raquo;</li>
 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2012-2013, Oliver Nagy.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>