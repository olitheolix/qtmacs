


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>qtmacs.extensions.qtmacsscintilla_macros &mdash; Qtmacs 0.1 documentation</title>
    
    <link rel="stylesheet" href="../../../_static/cloud.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Noticia+Text|Open+Sans|Droid+Sans+Mono" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.cookie.js"></script>
    <script type="text/javascript" src="../../../_static/cloud.js"></script>
    <link rel="top" title="Qtmacs 0.1 documentation" href="../../../index.html" />
    <link rel="up" title="Module code" href="../../index.html" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body>
    <div class="relbar-top">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">Qtmacs 0.1 documentation</a> &raquo;</li>

          <li><a href="../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for qtmacs.extensions.qtmacsscintilla_macros</h1><div class="highlight"><pre>
<span class="c"># Copyright 2012, Oliver Nagy &lt;qtmacsdev@gmail.com&gt;</span>
<span class="c">#</span>
<span class="c"># This file is part of Qtmacs.</span>
<span class="c">#</span>
<span class="c"># Qtmacs is free software: you can redistribute it and/or modify</span>
<span class="c"># it under the terms of the GNU General Public License as published by</span>
<span class="c"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c"># (at your option) any later version.</span>
<span class="c">#</span>
<span class="c"># Qtmacs is distributed in the hope that it will be useful,</span>
<span class="c"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="c"># GNU General Public License for more details.</span>
<span class="c">#</span>
<span class="c"># You should have received a copy of the GNU General Public License</span>
<span class="c"># along with Qtmacs. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Default macros and key bindings for ``QtmacsScintilla``.</span>

<span class="sd">The ``qteAddWidget`` method of ``QtmacsApplet`` uses this file to</span>
<span class="sd">endow ``QtmacsScintilla`` widgets with their default macros and</span>
<span class="sd">key bindings. The entry point to this module is the function</span>
<span class="sd">``install_macros_and_bindings``.</span>

<span class="sd">.. note: Macros are only registered if they do not yet exist. However,</span>
<span class="sd">   if a macro with the same name already does exists, then it is *not*</span>
<span class="sd">   replaced.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">qtmacs.kill_list</span>
<span class="kn">import</span> <span class="nn">qtmacs.undo_stack</span>
<span class="kn">import</span> <span class="nn">qtmacs.auxiliary</span>
<span class="kn">import</span> <span class="nn">qtmacs.type_check</span>
<span class="kn">import</span> <span class="nn">qtmacs.miniapplets.base_query</span>
<span class="kn">import</span> <span class="nn">qtmacs.qte_global</span> <span class="kn">as</span> <span class="nn">qte_global</span>
<span class="kn">import</span> <span class="nn">qtmacs.extensions.qtmacsscintilla_widget</span> <span class="kn">as</span> <span class="nn">scintilla_widget</span>
<span class="kn">from</span> <span class="nn">PyQt4</span> <span class="kn">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span>
<span class="kn">from</span> <span class="nn">qtmacs.base_macro</span> <span class="kn">import</span> <span class="n">QtmacsMacro</span>

<span class="c"># Shorthands:</span>
<span class="n">QtmacsMessage</span> <span class="o">=</span> <span class="n">qtmacs</span><span class="o">.</span><span class="n">auxiliary</span><span class="o">.</span><span class="n">QtmacsMessage</span>
<span class="n">type_check</span> <span class="o">=</span> <span class="n">qtmacs</span><span class="o">.</span><span class="n">type_check</span><span class="o">.</span><span class="n">type_check</span>
<span class="n">KillListElement</span> <span class="o">=</span> <span class="n">qtmacs</span><span class="o">.</span><span class="n">kill_list</span><span class="o">.</span><span class="n">KillListElement</span>
<span class="n">QtmacsUndoStack</span> <span class="o">=</span> <span class="n">qtmacs</span><span class="o">.</span><span class="n">undo_stack</span><span class="o">.</span><span class="n">QtmacsUndoStack</span>
<span class="n">QtmacsUndoCommand</span> <span class="o">=</span> <span class="n">qtmacs</span><span class="o">.</span><span class="n">undo_stack</span><span class="o">.</span><span class="n">QtmacsUndoCommand</span>
<span class="n">MiniAppletBaseQuery</span> <span class="o">=</span> <span class="n">qtmacs</span><span class="o">.</span><span class="n">miniapplets</span><span class="o">.</span><span class="n">base_query</span><span class="o">.</span><span class="n">MiniAppletBaseQuery</span>

<span class="c"># Global variables:</span>
<span class="n">qteKilledTextFromRectangle</span> <span class="o">=</span> <span class="bp">None</span>


<span class="c"># ------------------------------------------------------------</span>
<span class="c">#                   Movement macros</span>
<span class="c"># ------------------------------------------------------------</span>


<div class="viewcode-block" id="ForwardChar"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.ForwardChar">[docs]</a><span class="k">class</span> <span class="nc">ForwardChar</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move cursor one character to the right.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_CHARRIGHT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BackwardChar"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.BackwardChar">[docs]</a><span class="k">class</span> <span class="nc">BackwardChar</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move cursor one character to the left.</span>
<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_CHARLEFT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ForwardWord"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.ForwardWord">[docs]</a><span class="k">class</span> <span class="nc">ForwardWord</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move cursor to beginning of next word.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDRIGHT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BackwardWord"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.BackwardWord">[docs]</a><span class="k">class</span> <span class="nc">BackwardWord</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move cursor to beginning of previous word.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDLEFT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="MoveStartOfLine"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.MoveStartOfLine">[docs]</a><span class="k">class</span> <span class="nc">MoveStartOfLine</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move cursor to the beginning of the line.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="MoveEndOfLine"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.MoveEndOfLine">[docs]</a><span class="k">class</span> <span class="nc">MoveEndOfLine</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move cursor to the end of the line.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_LINEEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="NextLine"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.NextLine">[docs]</a><span class="k">class</span> <span class="nc">NextLine</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move cursor to next line.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Determine the current positing, number of lines in the</span>
        <span class="c"># document, and columns in the last line of the document.</span>
        <span class="n">last_line</span><span class="p">,</span> <span class="n">last_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getNumLinesAndColumns</span><span class="p">()</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>

        <span class="c"># Return immediately if there is no next line.</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">&gt;=</span> <span class="n">last_line</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Try to place the cursor at the same index in the next line</span>
        <span class="c"># if possible (ie. if the next line has sufficiently many</span>
        <span class="c"># characters).</span>
        <span class="n">num_char</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="n">num_char</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_char</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="PreviousLine"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.PreviousLine">[docs]</a><span class="k">class</span> <span class="nc">PreviousLine</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move cursor to previous line.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>

        <span class="c"># Return immediately if there is no next line.</span>
        <span class="k">if</span> <span class="n">line</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Try to place the cursor at the same index in the next line</span>
        <span class="c"># if possible (ie. if the next line has sufficiently many</span>
        <span class="c"># characters).</span>
        <span class="n">num_char</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">line</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="n">num_char</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_char</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="EndOfDocument"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.EndOfDocument">[docs]</a><span class="k">class</span> <span class="nc">EndOfDocument</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move cursor to the very end of the ``QTextEdit``.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_DOCUMENTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BeginningOfDocument"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.BeginningOfDocument">[docs]</a><span class="k">class</span> <span class="nc">BeginningOfDocument</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Move cursor to the very beginning of the ``QTextEdit``.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    * *widget*: &#39;*&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ScrollDown"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.ScrollDown">[docs]</a><span class="k">class</span> <span class="nc">ScrollDown</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scroll up by approximately as much as is currently visible.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Move the visible portion of the widget down by 90%</span>
        <span class="c"># of the currently visible area.</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span>
        <span class="n">tot_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">maximumViewportSize</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.9</span> <span class="o">*</span> <span class="n">tot_height</span><span class="p">)</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>

        <span class="c"># Set the cursor to the first visible line.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">firstVisibleLine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="ScrollUp"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.ScrollUp">[docs]</a><span class="k">class</span> <span class="nc">ScrollUp</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Scroll down by approximately as much as is currently visible.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Move the visible portion of the widget up by 90%</span>
        <span class="c"># of the currently visible area.</span>
        <span class="n">bar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">verticalScrollBar</span><span class="p">()</span>
        <span class="n">tot_height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">maximumViewportSize</span><span class="p">()</span><span class="o">.</span><span class="n">height</span><span class="p">()</span>
        <span class="n">new_value</span> <span class="o">=</span> <span class="n">bar</span><span class="o">.</span><span class="n">value</span><span class="p">()</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.9</span> <span class="o">*</span> <span class="n">tot_height</span><span class="p">)</span>
        <span class="n">bar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">new_value</span><span class="p">)</span>

        <span class="c"># Set the cursor to the first visible line.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="n">line</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">firstVisibleLine</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>


<span class="c"># ------------------------------------------------------------</span>
<span class="c">#                     Editing macros</span>
<span class="c"># ------------------------------------------------------------</span>

</div>
<div class="viewcode-block" id="SelfInsert"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SelfInsert">[docs]</a><span class="k">class</span> <span class="nc">SelfInsert</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the last character from ``last_key_sequence`` defined in</span>
<span class="sd">    the global name space.</span>

<span class="sd">    The ``last_key_sequence`` variable is overwritten/updated every</span>
<span class="sd">    time the event handler in Qtmacs receives a new keyboard event.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="SelfInsert.qteRun"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SelfInsert.qteRun">[docs]</a>    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extract the last ``QKeyEvent`` from the keyboard sequence</span>
<span class="sd">        (there should only be one anyway, but just to be sure). Then</span>
<span class="sd">        extract the human readable text it represents and call the</span>
<span class="sd">        ``keyPressEvent`` method to insert it.</span>

<span class="sd">        Note that the method simply calls the original ``keyPressEvent``</span>
<span class="sd">        method and does not implement undo commands. The reason for the</span>
<span class="sd">        latter is that ``keyPressEvent`` takes care of updating the undo</span>
<span class="sd">        stack accordingly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keyEvent</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">last_key_sequence</span><span class="o">.</span><span class="n">toQKeyEventList</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">keyPressEvent</span><span class="p">(</span><span class="n">keyEvent</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="InsertNewline"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.InsertNewline">[docs]</a><span class="k">class</span> <span class="nc">InsertNewline</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert line break at current position.</span>

<span class="sd">    The EOL character used to implement this line break complies with</span>
<span class="sd">    the convention in the document and is handled internally by</span>
<span class="sd">    ``QtmacsScintilla`` widget.</span>

<span class="sd">    If the previous line was indented, then the new line will be too,</span>
<span class="sd">    at the same level. Indentation characters are always white spaces,</span>
<span class="sd">    never tabs.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39; *&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Determine the indentation level of the current line.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pat</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
        <span class="n">numIndent</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">())</span>

        <span class="c"># On Windows a new-line is prefixed with a &#39;\r&#39; character.</span>
        <span class="n">eolmode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">eolMode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">eolmode</span> <span class="o">==</span> <span class="n">scintilla_widget</span><span class="o">.</span><span class="n">QtmacsScintilla</span><span class="o">.</span><span class="n">EolWindows</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">numIndent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">numIndent</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SetMark"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SetMark">[docs]</a><span class="k">class</span> <span class="nc">SetMark</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Place the default mark at the current position in the document.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteSetMark</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteStatus</span><span class="p">(</span><span class="s">&#39;New mark at ({}, {})&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="IndentLine"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.IndentLine">[docs]</a><span class="k">class</span> <span class="nc">IndentLine</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Indent the current line one more level.</span>

<span class="sd">    Indentation characters are always white spaces, never tabs.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39; *&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Shorthands.</span>
        <span class="n">indentWidth</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">tabWidth</span><span class="p">()</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>

        <span class="c"># Backup the current state of the document for the undo</span>
        <span class="c"># object later.</span>
        <span class="n">textBefore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>

        <span class="c"># Get the entire line. Do not use &#39;text(line)&#39; to prevent</span>
        <span class="c"># problematic EOL symbols from occurring in the string, as</span>
        <span class="c"># these are platform specific.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_LINEENDEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">selectedText</span><span class="p">()</span>

        <span class="c"># Match the largest chunk of white space at the beginning of</span>
        <span class="c"># the string. Note that _pat.match(text) will always match at</span>
        <span class="c"># least an empty string and therefore never return a ``None``</span>
        <span class="c"># object, which is why this case is not checked explicitly.</span>
        <span class="n">white</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pat</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">white</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="c"># If the entire string consists only of white spaces then</span>
            <span class="c"># delete it entirely and insert as many white space characters</span>
            <span class="c"># as necessary to reach the next indentation level.</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">col</span> <span class="o">+</span> <span class="n">indentWidth</span>
            <span class="n">numIndent</span> <span class="o">=</span> <span class="n">indentWidth</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">tmp</span> <span class="o">/</span> <span class="n">indentWidth</span><span class="p">)</span>
            <span class="n">newText</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">numIndent</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># If there is text on the line then indent it one more level.</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">indentWidth</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">white</span><span class="p">)</span>
            <span class="n">numIndent</span> <span class="o">=</span> <span class="n">indentWidth</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">tmp</span> <span class="o">/</span> <span class="n">indentWidth</span><span class="p">)</span>
            <span class="n">numIndent</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">white</span><span class="p">)</span>
            <span class="n">newText</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">numIndent</span> <span class="o">+</span> <span class="n">text</span>

        <span class="c"># Replace the current line with the newly indented line and place</span>
        <span class="c"># the cursor at the first non-whitespace character.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">replaceSelectedText</span><span class="p">(</span><span class="n">newText</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">white</span><span class="p">)</span> <span class="o">+</span> <span class="n">numIndent</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="DelCharBackward"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.DelCharBackward">[docs]</a><span class="k">class</span> <span class="nc">DelCharBackward</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete the character to the left of the cursor.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_CHARLEFTEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">removeSelectedText</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="DelChar"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.DelChar">[docs]</a><span class="k">class</span> <span class="nc">DelChar</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete character to the right of the cursor.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Determine the number of lines and columns in last line.</span>
        <span class="n">last_line</span><span class="p">,</span> <span class="n">last_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getNumLinesAndColumns</span><span class="p">()</span>

        <span class="c"># Return immediately if we are the end of the file.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">==</span> <span class="n">last_line</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="n">last_col</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_CHARRIGHTEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">removeSelectedText</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="KillWord"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.KillWord">[docs]</a><span class="k">class</span> <span class="nc">KillWord</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete the word to the right of the cursor.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Determine the number of lines and columns in last line.</span>
        <span class="n">last_line</span><span class="p">,</span> <span class="n">last_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getNumLinesAndColumns</span><span class="p">()</span>

        <span class="c"># Return immediately if we are the end of the file.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">==</span> <span class="n">last_line</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="n">last_col</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="c"># Let QsciScintilla select the word to the right</span>
        <span class="c"># of the cursor.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDRIGHTENDEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">removeSelectedText</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="BackwardKillWord"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.BackwardKillWord">[docs]</a><span class="k">class</span> <span class="nc">BackwardKillWord</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Delete word to the left of the cursor.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Return immediately if we are the start of the file.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">line</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span>

        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDLEFTEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">removeSelectedText</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="UpperWord"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.UpperWord">[docs]</a><span class="k">class</span> <span class="nc">UpperWord</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make the current word all upper case.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="c"># Select the current word by first moving to the end of it,</span>
        <span class="c"># and then asking Scintilla to select it leftwards.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDRIGHTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDLEFTEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">selectedText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">replaceSelectedText</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="LowerWord"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.LowerWord">[docs]</a><span class="k">class</span> <span class="nc">LowerWord</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Make the current word all lower case.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="c"># Select the current word by first moving to the end of it,</span>
        <span class="c"># and then asking Scintilla to select it leftwards.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDRIGHTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDLEFTEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">selectedText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">replaceSelectedText</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="CapitaliseWord"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.CapitaliseWord">[docs]</a><span class="k">class</span> <span class="nc">CapitaliseWord</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Capitalise the current word.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="c"># Select the current word by first moving to the end of it,</span>
        <span class="c"># and then asking Scintilla to select it leftwards.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDRIGHTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDLEFTEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">selectedText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">replaceSelectedText</span><span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">capitalize</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="TransposeWord"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.TransposeWord">[docs]</a><span class="k">class</span> <span class="nc">TransposeWord</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transpose current- for previous word.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Clear any selections.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="c"># Select the current word by first moving to the end of it,</span>
        <span class="c"># and then asking Scintilla to select it leftwards. Also</span>
        <span class="c"># store the left- and right position of the word (for the</span>
        <span class="c"># redo operation).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDRIGHTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pos0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDLEFTEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pos1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>

        <span class="c"># Continue in the same manner to identify the whitespace</span>
        <span class="c"># gap between the two words.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDLEFTENDEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pos2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>

        <span class="c"># Continue in the same manner to identify the second</span>
        <span class="c"># word to the left.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_WORDLEFTEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">pos3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>

        <span class="c"># Select and backup the right word.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">pos0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">right_word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">selectedText</span><span class="p">()</span>

        <span class="c"># Select and backup the white space between the two words.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">pos1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">selectedText</span><span class="p">()</span>

        <span class="c"># Select and backup the left word.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">pos2</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos2</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos3</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">left_word</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">selectedText</span><span class="p">()</span>

        <span class="c"># Select, backup, and delete the union of all three regions.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">pos0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pos3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos3</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">replaceSelectedText</span><span class="p">(</span><span class="n">right_word</span> <span class="o">+</span> <span class="n">space</span> <span class="o">+</span> <span class="n">left_word</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TransposeChar"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.TransposeChar">[docs]</a><span class="k">class</span> <span class="nc">TransposeChar</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transpose the two characters on the left- and right side of the cursor.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># No transposition occurs at the beginning of the line.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Clear the selection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="c"># Select the character to the left and right of the cursor.</span>
        <span class="c"># To do so, first move behind the next character, and then</span>
        <span class="c"># extend the selection back two characters.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_CHARRIGHT</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_CHARLEFTEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_CHARLEFTEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c"># Replace the current selection with its reverse.</span>
        <span class="n">chars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">selectedText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">replaceSelectedText</span><span class="p">(</span><span class="n">chars</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="KillLine"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.KillLine">[docs]</a><span class="k">class</span> <span class="nc">KillLine</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kill to the end of the line and place the content into the kill-list.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Shorthand variables and clear the selection.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="c"># Determine the text to the right of the cursor.</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">line</span><span class="p">)[</span><span class="n">col</span><span class="p">:]</span>

        <span class="c"># If this text merely constitutes an end-of-line (EOL) character</span>
        <span class="c"># then delete it, otherwise mark only the characters up to the</span>
        <span class="c"># end-of-line character.</span>
        <span class="k">if</span> <span class="n">text</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="c"># EOL on Windows.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">text</span> <span class="o">==</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">:</span>
            <span class="c"># EOL on Mac and Unix.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># There is more than just an EOL character left.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCI_LINEENDEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">removeSelectedText</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="KillRegion"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.KillRegion">[docs]</a><span class="k">class</span> <span class="nc">KillRegion</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kill the text between the cursor and the last mark.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteGetMark</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Shorthand variables for the position of the mark and cursor.</span>
        <span class="n">cur_line</span><span class="p">,</span> <span class="n">cur_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span>
        <span class="n">mark_line</span><span class="p">,</span> <span class="n">mark_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span>

        <span class="c"># Kill the selected text.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">cur_line</span><span class="p">,</span> <span class="n">cur_col</span><span class="p">,</span> <span class="n">mark_line</span><span class="p">,</span> <span class="n">mark_col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">removeSelectedText</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="Yank"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.Yank">[docs]</a><span class="k">class</span> <span class="nc">Yank</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Re-insert the last killed element.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Do nothing if the kill-list is empty.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qte_global</span><span class="o">.</span><span class="n">kill_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Traverse the kill-list until an element with plain text data</span>
        <span class="c"># was found.</span>
        <span class="n">killListData</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">dataText</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">kill_list</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">killListData</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># Yank the text and trigger the &#39;yank-qtmacs_scintilla&#39;</span>
                <span class="c"># which will be intercepted by YankPop.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="n">msgObj</span> <span class="o">=</span> <span class="n">QtmacsMessage</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRunHook</span><span class="p">(</span><span class="s">&#39;yank-qtmacs_scintilla&#39;</span><span class="p">,</span> <span class="n">msgObj</span><span class="p">)</span>
                <span class="k">return</span>

</div>
<div class="viewcode-block" id="YankPop"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.YankPop">[docs]</a><span class="k">class</span> <span class="nc">YankPop</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Replace the just yanked element with the previous one in the</span>
<span class="sd">    kill-list.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">killListIdx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteConnectHook</span><span class="p">(</span><span class="s">&#39;yank-qtmacs_scintilla&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">enableHook</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Do nothing if the kill-list contains no earlier element.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">killListIdx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Traverse the kill-list in reverse from where we left off.</span>
        <span class="n">kill_list</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">kill_list</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">killListIdx</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">kill_list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">killListIdx</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">dataText</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">dataText</span><span class="p">())</span>
                <span class="c"># Permanently remove the last undo object from the undo stack</span>
                <span class="c"># and call its reverseCommit method to remove the previously</span>
                <span class="c"># yanked kill-list element.</span>
                <span class="n">undoObjOld</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteUndoStack</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">undoObjOld</span><span class="o">.</span><span class="n">reverseCommit</span><span class="p">()</span>

                <span class="c"># Insert the currently selected kill-list element instead.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
                <span class="k">return</span>

<div class="viewcode-block" id="YankPop.disableHook"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.YankPop.disableHook">[docs]</a>    <span class="k">def</span> <span class="nf">disableHook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgObj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disable yank-pop.</span>

<span class="sd">        The ``enableHook`` method (see below) connects this method</span>
<span class="sd">        to the ``qtesigKeyseqComplete`` signal to catch</span>
<span class="sd">        consecutive calls to this ``yank-pop`` macro. Once the user</span>
<span class="sd">        issues a key sequence for any other macro but this one, the</span>
<span class="sd">        kill-list index will be set to a negative index, effectively</span>
<span class="sd">        disabling the macro.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Unpack the data structure.</span>
        <span class="n">macroName</span><span class="p">,</span> <span class="n">keysequence</span> <span class="o">=</span> <span class="n">msgObj</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="n">macroName</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMacroName</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qtesigKeyseqComplete</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">disableHook</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">killListIdx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
</div>
<div class="viewcode-block" id="YankPop.enableHook"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.YankPop.enableHook">[docs]</a>    <span class="k">def</span> <span class="nf">enableHook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgObj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable yank-pop.</span>

<span class="sd">        This method is connected to the &#39;yank-qtmacs_scintilla&#39; hook</span>
<span class="sd">        (triggered by the yank macro) to ensure that yank-pop only</span>
<span class="sd">        gets activated after the yank-macro.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">killListIdx</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">qte_global</span><span class="o">.</span><span class="n">kill_list</span><span class="p">)</span> <span class="o">-</span> <span class="n">msgObj</span><span class="o">.</span><span class="n">data</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qtesigKeyseqComplete</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">disableHook</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="OpenLine"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.OpenLine">[docs]</a><span class="k">class</span> <span class="nc">OpenLine</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Open a new line (ie. insert a new-line at the current cursor position).</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Shorthands.</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="n">eolmode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">eolMode</span><span class="p">()</span>

        <span class="c"># On Windows a new-line is prefixed with a &#39;\r&#39; character.</span>
        <span class="k">if</span> <span class="n">eolmode</span> <span class="o">==</span> <span class="n">scintilla_widget</span><span class="o">.</span><span class="n">QtmacsScintilla</span><span class="o">.</span><span class="n">EolWindows</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\r\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="c"># Return the cursor to the original position.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="o">*</span><span class="n">pos</span><span class="p">)</span>


<span class="c"># ------------------------------------------------------------</span>
<span class="c"># Macros that operate on rectangular regions. All these macros</span>
<span class="c"># require customised undo objects which are defined in this</span>
<span class="c"># section as well.</span>
<span class="c"># ------------------------------------------------------------</span>

</div>
<div class="viewcode-block" id="UndoKillRectangle"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.UndoKillRectangle">[docs]</a><span class="k">class</span> <span class="nc">UndoKillRectangle</span><span class="p">(</span><span class="n">QtmacsUndoCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement kill-rectangle and its inverse.</span>

<span class="sd">    This method works in tandem with ``UndoKillRectangle``. Whatever</span>
<span class="sd">    this class kills it stores in the module global variable</span>
<span class="sd">    ``qteKilledTextFromRectangle``, so that ``UndoYankRectangle`` can</span>
<span class="sd">    yank it again. Note that ``qteKilledTextFromRectangle`` is</span>
<span class="sd">    overwritten every time, ie. there is no equivalent to a kill-list</span>
<span class="sd">    like for the ``KillLine`` macro.</span>

<span class="sd">    |Args|</span>

<span class="sd">    * ``qteWidget`` (**QWidget**): the widget to use.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qteWidget</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span> <span class="o">=</span> <span class="n">qteWidget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseClass</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">qteWidget</span><span class="p">),</span> <span class="n">qteWidget</span><span class="p">)</span>

<div class="viewcode-block" id="UndoKillRectangle.commit"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.UndoKillRectangle.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert the specified text in all selected lines, always</span>
<span class="sd">        at the same column position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Get the number of lines and columns in last line.</span>
        <span class="n">last_line</span><span class="p">,</span> <span class="n">last_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getNumLinesAndColumns</span><span class="p">()</span>

        <span class="c"># If this is the first ever call to this undo/redo element</span>
        <span class="c"># then backup the current cursor- and marker position because</span>
        <span class="c"># both will be required for the redo operation.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Get the default marker and ensure it points to a</span>
            <span class="c"># valid location inside the document.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteGetMark</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">isPositionValid</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">):</span>
                <span class="k">return</span>

            <span class="c"># Backup the current cursor and marker position; swap</span>
            <span class="c"># one for the other if necessary to ensure the marker</span>
            <span class="c"># comes first.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span>

        <span class="c"># Shorthand for qteWidget and left/right position of rectangle.</span>
        <span class="n">wid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span>
        <span class="n">col1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">col2</span> <span class="o">=</span> <span class="nb">max</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="c"># Insert the specified string at the same position in every line</span>
        <span class="c"># in between the mark and the cursor (inclusive).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removedText</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="n">wid</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">col1</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="c"># If the line has no text in the specified column</span>
                <span class="c"># range then ignore it.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">removedText</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">col2</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="c"># If the col1-col2 range spans only part of the</span>
                <span class="c"># line then select only that part.</span>
                <span class="n">wid</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col1</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col1</span><span class="p">)</span>
                <span class="n">wid</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">wid</span><span class="o">.</span><span class="n">SCI_LINEENDEXTEND</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># If the col1-col2 range is a subset of the entire</span>
                <span class="c"># line then select the entire range.</span>
                <span class="n">wid</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col1</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col2</span><span class="p">)</span>

            <span class="c"># Backup and remove the selected text.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removedText</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">selectedText</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseClass</span><span class="o">.</span><span class="n">removeSelectedText</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c"># Determine the user selected string length and initialise the global</span>
        <span class="c"># variable qteKilledTextFromRectangle with an empty dictionary.</span>
        <span class="n">strlen</span> <span class="o">=</span> <span class="n">col2</span> <span class="o">-</span> <span class="n">col1</span>
        <span class="k">global</span> <span class="n">qteKilledTextFromRectangle</span>
        <span class="n">qteKilledTextFromRectangle</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Copy the removed text into the global variable</span>
        <span class="c"># &#39;qteKilledTextFromRectangle&#39; so that YankRectangle can</span>
        <span class="c"># access it. However, ensure that every element has exactly</span>
        <span class="c"># the length specified by the user defined rectangle; zero pad</span>
        <span class="c"># elements that are too short. Note: do not apply this zero</span>
        <span class="c"># padding to self.removedText because otherwise the text could</span>
        <span class="c"># not be undone correctly.</span>
        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">removedText</span><span class="p">:</span>
            <span class="c"># Determine how many white space characters are required</span>
            <span class="c"># to make the string &#39;strLen&#39; characters long.</span>
            <span class="n">pad</span> <span class="o">=</span> <span class="n">strlen</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>

            <span class="c"># Sanity check.</span>
            <span class="k">if</span> <span class="n">pad</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">qteKillTextFromRectangle</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;Padding length cannot be negative --&gt; this is a bug&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qteLogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c"># Store the padded version of the string.</span>
            <span class="n">qteKilledTextFromRectangle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="n">pad</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UndoKillRectangle.reverseCommit"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.UndoKillRectangle.reverseCommit">[docs]</a>    <span class="k">def</span> <span class="nf">reverseCommit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Re-insert the previously deleted line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Remove the specified string from the same position in every line</span>
        <span class="c"># in between the mark and the cursor (inclusive).</span>
        <span class="n">col</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">rng</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rng</span><span class="p">):</span>
            <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">removedText</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">text</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baseClass</span><span class="o">.</span><span class="n">insertAt</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="KillRectangle"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.KillRectangle">[docs]</a><span class="k">class</span> <span class="nc">KillRectangle</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kill the text in the rectangle spanned by the cursor and last mark.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteGetMark</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">undoObj</span> <span class="o">=</span> <span class="n">UndoKillRectangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteUndoStack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">undoObj</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="UndoYankRectangle"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.UndoYankRectangle">[docs]</a><span class="k">class</span> <span class="nc">UndoYankRectangle</span><span class="p">(</span><span class="n">QtmacsUndoCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement yank-rectangle and its inverse.</span>

<span class="sd">    This method works in tandem with ``UndoKillRectangle``. Whatever</span>
<span class="sd">    UndoKillRectangle kills is written to the module global variable</span>
<span class="sd">    ``qteKilledTextFromRectangle``, which this class accesses to yank</span>
<span class="sd">    the text.</span>

<span class="sd">    |Args|</span>

<span class="sd">    * ``qteWidget`` (**QWidget**): the widget to use.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qteWidget</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span> <span class="o">=</span> <span class="n">qteWidget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseClass</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">qteWidget</span><span class="p">),</span> <span class="n">qteWidget</span><span class="p">)</span>

<div class="viewcode-block" id="UndoYankRectangle.commit"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.UndoYankRectangle.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert the specified text in all selected lines, always</span>
<span class="sd">        at the same column position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Get the number of lines and columns in the last line.</span>
        <span class="n">last_line</span><span class="p">,</span> <span class="n">last_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getNumLinesAndColumns</span><span class="p">()</span>

        <span class="c"># If this is the first ever call to this undo/redo element</span>
        <span class="c"># then backup the current cursor position because</span>
        <span class="c"># it will be required for the redo operation.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">qteKilledTextFromRectangle</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insertedText</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">qteKilledTextFromRectangle</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">)</span>

        <span class="c"># Insert the killed strings into their respective lines.</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">insertedText</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseClass</span><span class="o">.</span><span class="n">insertAt</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UndoYankRectangle.reverseCommit"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.UndoYankRectangle.reverseCommit">[docs]</a>    <span class="k">def</span> <span class="nf">reverseCommit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Re-insert the previously deleted line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Loop over all lines in the rectangle to remove the</span>
        <span class="c"># previously yanked strings.</span>
        <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">text</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">insertedText</span><span class="p">):</span>
            <span class="n">line</span> <span class="o">=</span> <span class="n">ii</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="c"># Select as many characters as the string is long and remove</span>
            <span class="c"># them.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseClass</span><span class="o">.</span><span class="n">removeSelectedText</span><span class="p">()</span>

        <span class="c"># Place the cursor at the original position.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="YankRectangle"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.YankRectangle">[docs]</a><span class="k">class</span> <span class="nc">YankRectangle</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Yank the text killed at the last invocation of kill-rectangle.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">qteKilledTextFromRectangle</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">undoObj</span> <span class="o">=</span> <span class="n">UndoYankRectangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteUndoStack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">undoObj</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="UndoStringInsertRectangle"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.UndoStringInsertRectangle">[docs]</a><span class="k">class</span> <span class="nc">UndoStringInsertRectangle</span><span class="p">(</span><span class="n">QtmacsUndoCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implement string-insert-rectangle and its inverse.</span>

<span class="sd">    |Args|</span>

<span class="sd">    * ``qteWidget`` (**QWidget**): the widget to use.</span>
<span class="sd">    * ``text`` (**str**): the string to insert.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qteWidget</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span> <span class="o">=</span> <span class="n">qteWidget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baseClass</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">qteWidget</span><span class="p">),</span> <span class="n">qteWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">text</span>

<div class="viewcode-block" id="UndoStringInsertRectangle.commit"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.UndoStringInsertRectangle.commit">[docs]</a>    <span class="k">def</span> <span class="nf">commit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert the specified text in all selected lines, always</span>
<span class="sd">        at the same column position.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Get the number of lines and columns in last line.</span>
        <span class="n">last_line</span><span class="p">,</span> <span class="n">last_col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getNumLinesAndColumns</span><span class="p">()</span>

        <span class="c"># If this is the first ever call to this undo/redo element</span>
        <span class="c"># then backup the current cursor- and marker position because</span>
        <span class="c"># both will be required for the redo operation.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Get the default marker and ensure it points to a</span>
            <span class="c"># valid location inside the document.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteGetMark</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">isPositionValid</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">):</span>
                <span class="k">return</span>

            <span class="c"># Backup the current cursor and marker position; swap</span>
            <span class="c"># one for the other if necessary to ensure the marker</span>
            <span class="c"># comes first.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span>

        <span class="c"># Insert the specified string at the same position in every line</span>
        <span class="c"># in between the mark and the cursor (inclusive).</span>
        <span class="n">col</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseClass</span><span class="o">.</span><span class="n">insertAt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="UndoStringInsertRectangle.reverseCommit"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.UndoStringInsertRectangle.reverseCommit">[docs]</a>    <span class="k">def</span> <span class="nf">reverseCommit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Re-insert the previously deleted line.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Remove the specified string from the same position in every line</span>
        <span class="c"># in between the mark and the cursor (inclusive).</span>
        <span class="n">col</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markerPos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baseClass</span><span class="o">.</span><span class="n">removeSelectedText</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorPos</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="StringInsertRectangle"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.StringInsertRectangle">[docs]</a><span class="k">class</span> <span class="nc">StringInsertRectangle</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert a string at every line in the selected rectangle.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="StringInsertRectangle.Query"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.StringInsertRectangle.Query">[docs]</a>    <span class="k">class</span> <span class="nc">Query</span><span class="p">(</span><span class="n">MiniAppletBaseQuery</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query a string.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="k">def</span> <span class="nf">generateCompletions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">def</span> <span class="nf">inputCompleted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userInput</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">userInput</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultChoice</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="n">userInput</span>
            <span class="n">undoObj</span> <span class="o">=</span> <span class="n">UndoStringInsertRectangle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteUndoStack</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">undoObj</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

        <span class="c"># History of inserted strings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteQueryHistory</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Return immediately if no mark has been set.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteGetMark</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Compile a description and default value for the insertion.</span>
        <span class="n">prefixStr</span> <span class="o">=</span> <span class="s">&#39;String insert rectangle (default: {}):&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteQueryHistory</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">default</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteQueryHistory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">prefixStr</span> <span class="o">=</span> <span class="n">prefixStr</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">default</span><span class="p">))</span>

        <span class="c"># Instantiate the customised new mini applet query object to</span>
        <span class="c"># ask for the string to insert.</span>
        <span class="n">query</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="p">,</span>
                           <span class="n">prefix</span><span class="o">=</span><span class="n">prefixStr</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qteQueryHistory</span><span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="n">default</span>

        <span class="c"># Install the query object as the mini applet and return</span>
        <span class="c"># control to the event loop.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteAddMiniApplet</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SearchForwardMiniApplet"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SearchForwardMiniApplet">[docs]</a><span class="k">class</span> <span class="nc">SearchForwardMiniApplet</span><span class="p">(</span><span class="n">MiniAppletBaseQuery</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query a string and find all occurrences of it in the Scintilla widget.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="SearchForwardMiniApplet.HighlightNextMatch"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SearchForwardMiniApplet.HighlightNextMatch">[docs]</a>    <span class="k">class</span> <span class="nc">HighlightNextMatch</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Call ``highlightNextMatch`` method in the ``SearchForward``</span>
<span class="sd">        mini applet.</span>

<span class="sd">        |Signature|</span>

<span class="sd">        * *applet*: &#39;MiniApplet&#39;</span>
<span class="sd">        * *widget*: ``QTextEdit``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;MiniApplet&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QTextEdit&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="o">.</span><span class="n">highlightNextMatch</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="SearchForwardMiniApplet.InsertNewlineChar"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SearchForwardMiniApplet.InsertNewlineChar">[docs]</a>    <span class="k">class</span> <span class="nc">InsertNewlineChar</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a new line character into the search query.</span>

<span class="sd">        |Signature|</span>

<span class="sd">        * *applet*: &#39;MiniApplet&#39;</span>
<span class="sd">        * *widget*: ``QTextEdit``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;MiniApplet&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QTextEdit&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insertPlainText</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c"># The default search string. This one is set manually</span>
        <span class="c"># when the Query object is instantiated.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c"># Position and style of each match. Will be updated</span>
        <span class="c"># as the user types.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># The currently selected match.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Original cursor position.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorPosOrig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>

        <span class="c"># Shorthands.</span>
        <span class="n">SCI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span>

        <span class="c"># Make a copy of the style bits.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">getNumLinesAndColumns</span><span class="p">()</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCIGetStyledText</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span> <span class="o">=</span> <span class="n">style</span>

        <span class="c"># Define two new text styles, one for highlighting all</span>
        <span class="c"># matches, and one for highlighting only the currently</span>
        <span class="c"># selected match.</span>
        <span class="n">font</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;courier new&#39;</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETFONT</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETFORE</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0xFFFFFF</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETBACK</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETFONT</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETFORE</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mh">0x7f7f7f</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETBACK</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mh">0xcd00</span><span class="p">)</span>

        <span class="c"># Disable the lexer to avoid interfering with the Scintilla</span>
        <span class="c"># internal styling engine. The lexer will be re-enabled</span>
        <span class="c"># when this widget is closed (see qteToBeKilled method).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">originalLexer</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">qteLexer</span><span class="p">()</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">qteSetLexer</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

        <span class="c"># Register the SearchForward macro and bind it to &lt;ctrl&gt;+s.</span>
        <span class="n">register</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span>
        <span class="n">bind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span>
        <span class="n">macroName</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HighlightNextMatch</span><span class="p">,</span> <span class="n">replaceMacro</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Ctrl&gt;+s&#39;</span><span class="p">,</span> <span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>

        <span class="n">macroName</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InsertNewlineChar</span><span class="p">,</span> <span class="n">replaceMacro</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Ctrl&gt;+q &lt;ctrl&gt;+j&#39;</span><span class="p">,</span> <span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>

        <span class="c"># Connect to the Qt native textChanged slot to be informed whenever</span>
        <span class="c"># the user has typed anything. This is more convenient and targeted</span>
        <span class="c"># than using Qtmacs&#39; internal qtesigKeypressed. Also connect to the</span>
        <span class="c"># abort slot to restore the original cursor position.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteTextChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qtesigAbort</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteAbort</span><span class="p">)</span>

<div class="viewcode-block" id="SearchForwardMiniApplet.clearHighlighting"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SearchForwardMiniApplet.clearHighlighting">[docs]</a>    <span class="k">def</span> <span class="nf">clearHighlighting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the original style properties of all matches.</span>

<span class="sd">        This method effectively removes all visible traces of</span>
<span class="sd">        the match highlighting.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SCI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCISetStylingEx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span><span class="p">)</span>

        <span class="c"># Clear out the match set and reset the match index.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span> <span class="o">=</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="SearchForwardMiniApplet.highlightNextMatch"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SearchForwardMiniApplet.highlightNextMatch">[docs]</a>    <span class="k">def</span> <span class="nf">highlightNextMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select and highlight the next match in the set of matches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># If this method was called on an empty input field (ie.</span>
        <span class="c"># if the user hit &lt;ctrl&gt;+s again) then pick the default</span>
        <span class="c"># selection.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defaultChoice</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># If the mathIdx variable is out of bounds (eg. the last possible</span>
        <span class="c"># match is already selected) then wrap it around.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span>

        <span class="c"># Shorthand.</span>
        <span class="n">SCI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span>

        <span class="c"># Undo the highlighting of the previously selected match.</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STARTSTYLING</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_SETSTYLING</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

        <span class="c"># Highlight the next match.</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span><span class="p">]</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STARTSTYLING</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_SETSTYLING</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>

        <span class="c"># Place the cursor at the start of the currently selected match.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">+=</span> <span class="mi">1</span>
</div>
    <span class="k">def</span> <span class="nf">compileMatchList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get the new sub-string to search for.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">curEntry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="n">numChar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">curEntry</span><span class="p">)</span>

        <span class="c"># Return immediately if the input field is empty.</span>
        <span class="k">if</span> <span class="n">numChar</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Compile a list of all sub-string spans.</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">curEntry</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">numChar</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>

<div class="viewcode-block" id="SearchForwardMiniApplet.qteTextChanged"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SearchForwardMiniApplet.qteTextChanged">[docs]</a>    <span class="k">def</span> <span class="nf">qteTextChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for sub-string matches.</span>

<span class="sd">        This method is triggered by Qt whenever the text changes,</span>
<span class="sd">        ie. whenever the user has altered the input. Extract the</span>
<span class="sd">        new input, find all matches, and highlight them accordingly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Remove any previous highlighting.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearHighlighting</span><span class="p">()</span>
        <span class="n">SCI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span>

        <span class="c"># Compile a list of spans that contain the specified string.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compileMatchList</span><span class="p">()</span>

        <span class="c"># Return if the substring does not exist in the text.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># ------------------------------------------------------------</span>
        <span class="c"># Make a copy of the style bits of the document, overwrite</span>
        <span class="c"># those parts containing a substring, and then write them</span>
        <span class="c"># back all at once. This is much faster than calling the</span>
        <span class="c"># styling methods repeatedly.</span>
        <span class="c"># ------------------------------------------------------------</span>

        <span class="c"># Make a copy of the document style bits and determine the</span>
        <span class="c"># cursor position in the document.</span>
        <span class="n">style</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span><span class="p">)</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">positionFromLineIndex</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorPosOrig</span><span class="p">)</span>

        <span class="c"># Style all matches.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">cur</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">style</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x1e</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>

        <span class="c"># If the cursor is after the last possible match (eg. always</span>
        <span class="c"># the case when the cursor is at the end of the file) then</span>
        <span class="c"># self.selMatchIdx will point beyond the list.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Style the first match after the current cursor position</span>
        <span class="c"># differently to indicate that it is the currently</span>
        <span class="c"># selected one.</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span><span class="p">]</span>
        <span class="n">style</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x1f</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>

        <span class="c"># Place the cursor at the start of the currently selected match.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c"># Apply the modified style array to the document.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCISetStylingEx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SearchForwardMiniApplet.qteAbort"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SearchForwardMiniApplet.qteAbort">[docs]</a>    <span class="k">def</span> <span class="nf">qteAbort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgObj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the original cursor position because the user hit abort.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorPosOrig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qtesigAbort</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteAbort</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SearchForwardMiniApplet.qteToBeKilled"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SearchForwardMiniApplet.qteToBeKilled">[docs]</a>    <span class="k">def</span> <span class="nf">qteToBeKilled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove all selections and install the original lexer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearHighlighting</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteSetLexer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">originalLexer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteTextChanged</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="SearchForward"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SearchForward">[docs]</a><span class="k">class</span> <span class="nc">SearchForward</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for the occurrence of a substring.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

        <span class="c"># History of inserted strings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Instantiate the customised new mini applet query object to</span>
        <span class="c"># ask for the string to insert.</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">SearchForwardMiniApplet</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="p">,</span>
            <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;Search: &#39;</span><span class="p">,</span> <span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">)</span>

        <span class="c"># The default choice is the last search term.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">query</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c"># Install the query object as the mini applet and return</span>
        <span class="c"># control to the event loop.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteAddMiniApplet</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="SearchForwardRegexpMiniApplet"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SearchForwardRegexpMiniApplet">[docs]</a><span class="k">class</span> <span class="nc">SearchForwardRegexpMiniApplet</span><span class="p">(</span><span class="n">SearchForwardMiniApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interpret the user input as a regular expression and highlight</span>
<span class="sd">    all matches in the QtmacsScintilla widget as the user types.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">compileMatchList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get the new sub-string to search for.</span>
        <span class="n">curEntry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>

        <span class="c"># Return immediately if the input field is empty.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">curEntry</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># If the current user input does not constitute a valid</span>
        <span class="c"># regular expression then do nothing.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">curEntry</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Compile a list of all sub-string spans.</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">span</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">pat</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>

</div>
<div class="viewcode-block" id="SearchForwardRegexp"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SearchForwardRegexp">[docs]</a><span class="k">class</span> <span class="nc">SearchForwardRegexp</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search for sub-strings defined via a regular expression.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

        <span class="c"># History of inserted strings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Instantiate the customised new mini applet query object to</span>
        <span class="c"># ask for the string to insert.</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">SearchForwardRegexpMiniApplet</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;Search: &#39;</span><span class="p">,</span>
            <span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">)</span>

        <span class="c"># The default choice is the last search term.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">query</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c"># Install the query object as the mini applet and return</span>
        <span class="c"># control to the event loop.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteAddMiniApplet</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet">[docs]</a><span class="k">class</span> <span class="nc">QueryReplaceMiniApplet</span><span class="p">(</span><span class="n">MiniAppletBaseQuery</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query a two strings and replace all occurrences of the first with</span>
<span class="sd">    the second.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="QueryReplaceMiniApplet.NextQueryMode"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.NextQueryMode">[docs]</a>    <span class="k">class</span> <span class="nc">NextQueryMode</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Move to the next query mode (ie. from search string query to</span>
<span class="sd">        replacement string query to the final replacement operations).</span>

<span class="sd">        |Signature|</span>

<span class="sd">        * *applet*: &#39;MiniApplet&#39;</span>
<span class="sd">        * *widget*: ``QTextEdit``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;MiniApplet&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QTextEdit&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="o">.</span><span class="n">nextMode</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.InsertNewlineChar"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.InsertNewlineChar">[docs]</a>    <span class="k">class</span> <span class="nc">InsertNewlineChar</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Insert a new line character into the search query to facilitate</span>
<span class="sd">        searching for newlines as well.</span>

<span class="sd">        |Signature|</span>

<span class="sd">        * *applet*: &#39;MiniApplet&#39;</span>
<span class="sd">        * *widget*: ``QTextEdit``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;MiniApplet&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QTextEdit&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">insertPlainText</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.ReplaceAll"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.ReplaceAll">[docs]</a>    <span class="k">class</span> <span class="nc">ReplaceAll</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace all remaining matches.</span>

<span class="sd">        |Signature|</span>

<span class="sd">        * *applet*: &#39;MiniApplet&#39;</span>
<span class="sd">        * *widget*: ``QTextEdit``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;MiniApplet&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QTextEdit&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="o">.</span><span class="n">replaceAll</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.ReplaceNext"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.ReplaceNext">[docs]</a>    <span class="k">class</span> <span class="nc">ReplaceNext</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace the next match.</span>

<span class="sd">        |Signature|</span>

<span class="sd">        * *applet*: &#39;MiniApplet&#39;</span>
<span class="sd">        * *widget*: ``QTextEdit``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;MiniApplet&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QTextEdit&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="o">.</span><span class="n">replaceSelected</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteKillMiniApplet</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.SkipNext"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.SkipNext">[docs]</a>    <span class="k">class</span> <span class="nc">SkipNext</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Skip the next match.</span>

<span class="sd">        |Signature|</span>

<span class="sd">        * *applet*: &#39;MiniApplet&#39;</span>
<span class="sd">        * *widget*: ``QTextEdit``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;MiniApplet&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QTextEdit&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="o">.</span><span class="n">highlightNextMatch</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.Abort"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.Abort">[docs]</a>    <span class="k">class</span> <span class="nc">Abort</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Abort.</span>

<span class="sd">        |Signature|</span>

<span class="sd">        * *applet*: &#39;MiniApplet&#39;</span>
<span class="sd">        * *widget*: ``QTextEdit``</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;MiniApplet&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QTextEdit&#39;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="o">.</span><span class="n">qteAbort</span><span class="p">(</span><span class="n">QtmacsMessage</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteKillMiniApplet</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c"># The default search string. This one is set manually</span>
        <span class="c"># when the Query object is instantiated.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c"># Position and style of each match. Will be updated</span>
        <span class="c"># as the user types.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># The currently selected match.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Original cursor position.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cursorPosOrig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>

        <span class="c"># Shorthands.</span>
        <span class="n">SCI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span>

        <span class="c"># Make a copy of the style bits.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">getNumLinesAndColumns</span><span class="p">()</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCIGetStyledText</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span> <span class="o">=</span> <span class="n">style</span>

        <span class="c"># Define two new text styles, one for highlighting all</span>
        <span class="c"># matches, and one for highlighting only the currently</span>
        <span class="c"># selected match.</span>
        <span class="n">font</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="s">&#39;courier new&#39;</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETFONT</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETFORE</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mh">0xFFFFFF</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETBACK</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETFONT</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="n">font</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETFORE</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mh">0x7f7f7f</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STYLESETBACK</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mh">0xcd00</span><span class="p">)</span>

        <span class="c"># Disable the lexer to avoid interfering with the Scintilla</span>
        <span class="c"># internal styling engine. The lexer will be re-enabled</span>
        <span class="c"># when this widget is closed (see qteToBeKilled method).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">originalLexer</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">qteLexer</span><span class="p">()</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">qteSetLexer</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

        <span class="c"># Register the SearchForward macro and bind it to &lt;ctrl&gt;-s.</span>
        <span class="n">register</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span>
        <span class="n">bind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span>

        <span class="n">macroName</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NextQueryMode</span><span class="p">,</span> <span class="n">replaceMacro</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">,</span> <span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>

        <span class="n">macroName</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InsertNewlineChar</span><span class="p">,</span> <span class="n">replaceMacro</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;Ctrl&gt;+q &lt;ctrl&gt;+j&#39;</span><span class="p">,</span> <span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>

        <span class="c"># Connect to the Qt native textChanged slot to be informed</span>
        <span class="c"># whenever the user has typed anything. This is more</span>
        <span class="c"># convenient and targeted than using Qtmacs&#39; internal</span>
        <span class="c"># qtesigKeypressed. Also connect to the abort slot to restore</span>
        <span class="c"># the original cursor position.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteTextChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qtesigAbort</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteAbort</span><span class="p">)</span>

        <span class="c"># The string to replace, and its replacement.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toReplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toReplaceWith</span> <span class="o">=</span> <span class="bp">None</span>

        <span class="c"># Indicate whether we are querying for the string to replace</span>
        <span class="c"># (0), the string to replace it with (1), or the replacement</span>
        <span class="c"># operation (2).</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queryMode</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="QueryReplaceMiniApplet.nextMode"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.nextMode">[docs]</a>    <span class="k">def</span> <span class="nf">nextMode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Put the search-replace macro into the next stage. The first stage</span>
<span class="sd">        is the query stage to ask the user for the string to replace,</span>
<span class="sd">        the second stage is to query the string to replace it with,</span>
<span class="sd">        and the third allows to replace or skip individual matches,</span>
<span class="sd">        or replace them all automatically.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Terminate the replacement procedure if the no match was found.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteAbort</span><span class="p">(</span><span class="n">QtmacsMessage</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteKillMiniApplet</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">queryMode</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryMode</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c"># Disconnect the text-changed slot because no real time</span>
            <span class="c"># highlighting is necessary when entering the replacement</span>
            <span class="c"># string, unlike when entering the string to replace.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteTextChanged</span><span class="p">)</span>

            <span class="c"># Store the string to replace and clear out the query field.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toReplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteTextPrefix</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;mode 1&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">queryMode</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c"># Mode two is to replace or skip individual matches. For</span>
            <span class="c"># this purpose rebind the &quot;n&quot;, &quot;!&quot;, and &lt;space&gt; keys</span>
            <span class="c"># with the respective macros to facilitate it.</span>
            <span class="n">register</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span>
            <span class="n">bind</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span>

            <span class="c"># Unbind all keys from the input widget.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteUnbindAllFromWidgetObject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>

            <span class="n">macroName</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ReplaceAll</span><span class="p">,</span> <span class="n">replaceMacro</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">bind</span><span class="p">(</span><span class="s">&#39;!&#39;</span><span class="p">,</span> <span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>

            <span class="n">macroName</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ReplaceNext</span><span class="p">,</span> <span class="n">replaceMacro</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;space&gt;&#39;</span><span class="p">,</span> <span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>

            <span class="n">macroName</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SkipNext</span><span class="p">,</span> <span class="n">replaceMacro</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">bind</span><span class="p">(</span><span class="s">&#39;n&#39;</span><span class="p">,</span> <span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>

            <span class="n">macroName</span> <span class="o">=</span> <span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Abort</span><span class="p">,</span> <span class="n">replaceMacro</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">bind</span><span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">,</span> <span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>
            <span class="n">bind</span><span class="p">(</span><span class="s">&#39;&lt;enter&gt;&#39;</span><span class="p">,</span> <span class="n">macroName</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">toReplaceWith</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteTextPrefix</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;mode 2&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s">&#39;&lt;space&gt; to replace, &lt;n&gt; to skip, &#39;</span>
                                 <span class="s">&#39;&lt;!&gt; to replace all.&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteAbort</span><span class="p">(</span><span class="n">QtmacsMessage</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteKillMiniApplet</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.highlightNextMatch"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.highlightNextMatch">[docs]</a>    <span class="k">def</span> <span class="nf">highlightNextMatch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Select and highlight the next match in the set of matches.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># If this method was called on an empty input field (ie.</span>
        <span class="c"># if the user hit &lt;ctrl&gt;+s again) then pick the default</span>
        <span class="c"># selection.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">defaultChoice</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c"># If the mathIdx variable is out of bounds (eg. the last possible</span>
        <span class="c"># match is already selected) then wrap it around.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span>

        <span class="c"># Shorthand.</span>
        <span class="n">SCI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span>

        <span class="c"># Undo the highlighting of the previously selected match.</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span><span class="p">]</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STARTSTYLING</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_SETSTYLING</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="c"># Highlight the next match.</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span><span class="p">]</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_STARTSTYLING</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="mh">0xFF</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">SendScintilla</span><span class="p">(</span><span class="n">SCI</span><span class="o">.</span><span class="n">SCI_SETSTYLING</span><span class="p">,</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>

        <span class="c"># Place the cursor at the start of the currently selected match.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.replaceSelected"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.replaceSelected">[docs]</a>    <span class="k">def</span> <span class="nf">replaceSelected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace the currently selected string with the new one.</span>

<span class="sd">        The method return **False** if another match to the right</span>
<span class="sd">        of the cursor exists, and **True** if not (ie. when the</span>
<span class="sd">        end of the document was reached).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SCI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span>

        <span class="c"># Restore the original styling.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCISetStylingEx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span><span class="p">)</span>

        <span class="c"># Select the region spanned by the string to replace.</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span><span class="p">]</span>
        <span class="n">line1</span><span class="p">,</span> <span class="n">col1</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">line2</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">col1</span><span class="p">,</span> <span class="n">line2</span><span class="p">,</span> <span class="n">col2</span><span class="p">)</span>

        <span class="c"># Replace that region with the new string and move the cursor</span>
        <span class="c"># to the end of that string.</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">replaceSelectedText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toReplaceWith</span><span class="p">)</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toReplaceWith</span><span class="p">))</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="c"># Backup the new document style bits.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">getNumLinesAndColumns</span><span class="p">()</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCIGetStyledText</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span> <span class="o">=</span> <span class="n">style</span>

        <span class="c"># Determine if this was the last entry in the match list.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">highlightAllMatches</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.replaceAll"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.replaceAll">[docs]</a>    <span class="k">def</span> <span class="nf">replaceAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace all matches after the current cursor position.</span>

<span class="sd">        This method calls ``replaceSelectedText`` until it returns</span>
<span class="sd">        **False**, and then closes the mini buffer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">replaceSelected</span><span class="p">():</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCISetStylingEx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteKillMiniApplet</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.compileMatchList"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.compileMatchList">[docs]</a>    <span class="k">def</span> <span class="nf">compileMatchList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compile the list of spans of every match.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Get the new sub-string to search for.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Return immediately if the input field is empty.</span>
        <span class="n">numChar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toReplace</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">numChar</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Compile a list of all sub-string spans.</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toReplace</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stop</span> <span class="o">=</span> <span class="n">start</span> <span class="o">+</span> <span class="n">numChar</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.qteTextChanged"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.qteTextChanged">[docs]</a>    <span class="k">def</span> <span class="nf">qteTextChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whenever the content of the input field changes renew</span>
<span class="sd">        the search for matches and highlight the new set.</span>

<span class="sd">        Note that this functionality is only enabled in Mode 1;</span>
<span class="sd">        Mode 2 (which queries for the replacement string)</span>
<span class="sd">        disconnects this slot.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">toReplace</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">highlightAllMatches</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.highlightAllMatches"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.highlightAllMatches">[docs]</a>    <span class="k">def</span> <span class="nf">highlightAllMatches</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Search for sub-string matches.</span>

<span class="sd">        This method is triggered by Qt whenever the text changes,</span>
<span class="sd">        ie. whenever the user has altered the input. Extract the</span>
<span class="sd">        new input, find all matches, and highlight them accordingly.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Remove any previous highlighting.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCISetStylingEx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span><span class="p">)</span>
        <span class="n">SCI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span>

        <span class="c"># Compile a list of spans that contain the specified string.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compileMatchList</span><span class="p">()</span>

        <span class="c"># Return if the substring does not exist in the text.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># ------------------------------------------------------------</span>
        <span class="c"># Make a copy of the style bits of the document, overwrite</span>
        <span class="c"># those parts containing a substring, and then write them</span>
        <span class="c"># back all at once. This is much faster than calling the</span>
        <span class="c"># styling methods repeatedly.</span>
        <span class="c"># ------------------------------------------------------------</span>

        <span class="c"># Make a copy of the document style bits and determine the</span>
        <span class="c"># cursor position in the document.</span>
        <span class="n">style</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">getCursorPosition</span><span class="p">()</span>
        <span class="n">cur</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">positionFromLineIndex</span><span class="p">(</span><span class="o">*</span><span class="n">pos</span><span class="p">)</span>

        <span class="c"># Style all matches.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&lt;</span> <span class="n">cur</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">style</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x1e</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c"># Style the first match after the current cursor position</span>
        <span class="c"># differently to indicate that it is the currently</span>
        <span class="c"># selected one.</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span><span class="p">]</span>
        <span class="n">style</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]</span> <span class="o">=</span> <span class="nb">bytes</span><span class="p">(</span><span class="n">b</span><span class="s">&#39;</span><span class="se">\x1f</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>

        <span class="c"># Place the cursor at the start of the currently selected match.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="c"># Apply the modified style array to the document.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCISetStylingEx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">style</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.qteAbort"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.qteAbort">[docs]</a>    <span class="k">def</span> <span class="nf">qteAbort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msgObj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Restore the original cursor position because the user hit abort.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">cursorPosOrig</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qtesigAbort</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteAbort</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">textChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteTextChanged</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteSetLexer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">originalLexer</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="QueryReplaceMiniApplet.qteToBeKilled"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceMiniApplet.qteToBeKilled">[docs]</a>    <span class="k">def</span> <span class="nf">qteToBeKilled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove all selections and install the original lexer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCISetStylingEx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">qteSetLexer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">originalLexer</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="QueryReplace"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplace">[docs]</a><span class="k">class</span> <span class="nc">QueryReplace</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search and replace.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

        <span class="c"># History of inserted strings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Instantiate the customised new mini applet query object to</span>
        <span class="c"># ask for the string to insert.</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QueryReplaceMiniApplet</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;Replace: &#39;</span><span class="p">,</span>
            <span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">)</span>

        <span class="c"># The default choice is the last search term.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">query</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c"># Install the query object as the mini applet and return</span>
        <span class="c"># control to the event loop.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteAddMiniApplet</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="QueryReplaceRegexpMiniApplet"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceRegexpMiniApplet">[docs]</a><span class="k">class</span> <span class="nc">QueryReplaceRegexpMiniApplet</span><span class="p">(</span><span class="n">QueryReplaceMiniApplet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query a regular expression and a substitution string.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="QueryReplaceRegexpMiniApplet.replaceSelected"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceRegexpMiniApplet.replaceSelected">[docs]</a>    <span class="k">def</span> <span class="nf">replaceSelected</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Replace the currently selected string with the new one.</span>

<span class="sd">        The method return **False** if another match to the right</span>
<span class="sd">        of the cursor exists, and **True** if not (ie. when the</span>
<span class="sd">        end of the document was reached).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">SCI</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span>

        <span class="c"># Restore the original styling.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCISetStylingEx</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span><span class="p">)</span>

        <span class="c"># Select the region spanned by the string to replace.</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span><span class="p">]</span>
        <span class="n">line1</span><span class="p">,</span> <span class="n">col1</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
        <span class="n">line2</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">stop</span><span class="p">)</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">setSelection</span><span class="p">(</span><span class="n">line1</span><span class="p">,</span> <span class="n">col1</span><span class="p">,</span> <span class="n">line2</span><span class="p">,</span> <span class="n">col2</span><span class="p">)</span>

        <span class="n">text</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">selectedText</span><span class="p">()</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toReplace</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">toReplaceWith</span><span class="p">,</span> <span class="n">text</span><span class="p">)</span>

        <span class="c"># Replace that region with the new string and move the cursor</span>
        <span class="c"># to the end of that string.</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">replaceSelectedText</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">lineIndexFromPosition</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">))</span>
        <span class="n">SCI</span><span class="o">.</span><span class="n">setCursorPosition</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>

        <span class="c"># Backup the new document style bits.</span>
        <span class="n">line</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">SCI</span><span class="o">.</span><span class="n">getNumLinesAndColumns</span><span class="p">()</span>
        <span class="n">text</span><span class="p">,</span> <span class="n">style</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">SCIGetStyledText</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">styleOrig</span> <span class="o">=</span> <span class="n">style</span>

        <span class="c"># Determine if this was the last entry in the match list.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">matchList</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">selMatchIdx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">highlightAllMatches</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
</div>
    <span class="k">def</span> <span class="nf">compileMatchList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Get the new sub-string to search for.</span>
        <span class="n">curEntry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteText</span><span class="o">.</span><span class="n">toPlainText</span><span class="p">()</span>

        <span class="c"># Return immediately if the input field is empty.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">curEntry</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># If the current user input does not constitute a valid</span>
        <span class="c"># regular expression then do nothing.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">curEntry</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">MULTILINE</span> <span class="o">+</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">re</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c"># Compile a list of all sub-string spans.</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">matchList</span> <span class="o">=</span> <span class="p">[</span><span class="n">_</span><span class="o">.</span><span class="n">span</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">pat</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">)]</span>

</div>
<div class="viewcode-block" id="QueryReplaceRegexp"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.QueryReplaceRegexp">[docs]</a><span class="k">class</span> <span class="nc">QueryReplaceRegexp</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Search a regular expression and replace it with another custom string.</span>

<span class="sd">    This method uses Python&#39;s ``re`` module, in particular ``re.match``</span>
<span class="sd">    to find the string, and ``re.sub`` to replace it. As such, the</span>
<span class="sd">    search and replacement strings can be any regular expression syntax</span>
<span class="sd">    supported by the ``re`` module.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

        <span class="c"># History of inserted strings.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Instantiate the customised new mini applet query object to</span>
        <span class="c"># ask for the string to insert.</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">QueryReplaceRegexpMiniApplet</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s">&#39;Replace: &#39;</span><span class="p">,</span>
            <span class="n">history</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">)</span>

        <span class="c"># The default choice is the last search term.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">query</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteSearchHistory</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span><span class="o">.</span><span class="n">defaultChoice</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c"># Install the query object as the mini applet and return</span>
        <span class="c"># control to the event loop.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteAddMiniApplet</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>


<span class="c"># ------------------------------------------------------------</span>
<span class="c">#                       Other macros</span>
<span class="c"># ------------------------------------------------------------</span>

</div>
<div class="viewcode-block" id="Undo"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.Undo">[docs]</a><span class="k">class</span> <span class="nc">Undo</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Trigger the ``undo`` function of the active widget.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">undo</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="SaveFile"><a class="viewcode-back" href="../../../qtmacs_autodoc.html#qtmacs.extensions.qtmacsscintilla_macros.SaveFile">[docs]</a><span class="k">class</span> <span class="nc">SaveFile</span><span class="p">(</span><span class="n">QtmacsMacro</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Save the current text to file.</span>

<span class="sd">    |Signature|</span>

<span class="sd">    * *applet*: &#39;*&#39;</span>
<span class="sd">    * *widget*: ``QtmacsScintilla``</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetAppletSignature</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteSetWidgetSignature</span><span class="p">(</span><span class="s">&#39;QtmacsScintilla&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">qteRun</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">fileName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteApplet</span><span class="o">.</span><span class="n">qteAppletID</span><span class="p">()</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="nb">open</span><span class="p">(</span><span class="n">fileName</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteMain</span><span class="o">.</span><span class="n">qteStatus</span><span class="p">(</span><span class="s">&#39;Saved file &lt;b&gt;{}&lt;/b&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fileName</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qteWidget</span><span class="o">.</span><span class="n">setModified</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>


<span class="c"># ------------------------------------------------------------</span>
<span class="c">#               Assign the default key bindings</span>
<span class="c"># ------------------------------------------------------------</span>
</div>
<span class="k">def</span> <span class="nf">install_macros_and_bindings</span><span class="p">(</span><span class="n">widgetObj</span><span class="p">):</span>
    <span class="n">qteMain</span> <span class="o">=</span> <span class="n">qte_global</span><span class="o">.</span><span class="n">qteMain</span>

    <span class="c"># ------------------------------------------------------------</span>
    <span class="c">#  Install macros for alphanumeric characters. Note that all</span>
    <span class="c">#  these characters are processed by the self-insert macro.</span>
    <span class="c"># ------------------------------------------------------------</span>

    <span class="c"># All alphanumerical characters are processed by the same macro,</span>
    <span class="c"># namely &#39;self-insert&#39;. Therefore, specify all alphanumerical</span>
    <span class="c"># macros in a string and then install them in a loop. This is more</span>
    <span class="c"># readable and flexible than writing three dozen bind commands.</span>
    <span class="n">char_list</span> <span class="o">=</span> <span class="s">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span>
    <span class="n">char_list</span> <span class="o">+=</span> <span class="n">char_list</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="n">char_list</span> <span class="o">+=</span> <span class="s">&quot;0123456789&quot;</span>
    <span class="n">char_list</span> <span class="o">+=</span> <span class="s">&quot;&#39;</span><span class="se">\\</span><span class="s">[],=-.;/`&amp;^~*!|#(){}$&lt;&gt;%+?_&quot;</span>

    <span class="c"># Register the macro if it is not already.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteIsMacroRegistered</span><span class="p">(</span><span class="s">&#39;self-insert&#39;</span><span class="p">,</span> <span class="n">widgetObj</span><span class="p">):</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">SelfInsert</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">&#39;self-insert&#39;</span><span class="p">)</span>

    <span class="c"># Install the self-insert macro for every character in the</span>
    <span class="c"># char_list.</span>
    <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">char_list</span><span class="p">:</span>
        <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="n">char</span><span class="p">,</span> <span class="s">&#39;self-insert&#39;</span><span class="p">,</span> <span class="n">widgetObj</span><span class="p">)</span>

    <span class="c"># Install the self-insert macro for some additional keys that</span>
    <span class="c"># cannot easily be added to char_list.</span>
    <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s">&#39;self-insert&#39;</span><span class="p">,</span> <span class="n">widgetObj</span><span class="p">)</span>
    <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;space&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;self-insert&#39;</span><span class="p">,</span> <span class="n">widgetObj</span><span class="p">)</span>
    <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="s">&#39;&lt;colon&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;self-insert&#39;</span><span class="p">,</span> <span class="n">widgetObj</span><span class="p">)</span>

    <span class="c"># ------------------------------------------------------------</span>
    <span class="c">#  Install macros and key-bindings for all other macros.</span>
    <span class="c"># ------------------------------------------------------------</span>

    <span class="c"># For readability purposes, compile a list where each entry</span>
    <span class="c"># contains the macro name, macro class, and key binding associated</span>
    <span class="c"># with this macro.</span>
    <span class="n">macro_list</span> <span class="o">=</span> <span class="p">((</span><span class="n">InsertNewline</span><span class="p">,</span> <span class="s">&#39;&lt;return&gt;&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">InsertNewline</span><span class="p">,</span> <span class="s">&#39;&lt;enter&gt;&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">DelCharBackward</span><span class="p">,</span> <span class="s">&#39;&lt;backspace&gt;&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">DelChar</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+d&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">ForwardChar</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+f&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">ForwardWord</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+f&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">BackwardChar</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+b&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">BackwardWord</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+b&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">KillWord</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+d&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">BackwardKillWord</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+&lt;backspace&gt;&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">MoveStartOfLine</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+a&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">MoveEndOfLine</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+e&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">NextLine</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+n&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">PreviousLine</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+p&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">EndOfDocument</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+&gt;&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">BeginningOfDocument</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+&lt;&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">OpenLine</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+o&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">Undo</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+/&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">ScrollDown</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+v&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">ScrollUp</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+v&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">KillLine</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+k&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">Yank</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+y&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">YankPop</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+y&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">SaveFile</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+x &lt;ctrl&gt;+s&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">IndentLine</span><span class="p">,</span> <span class="s">&#39;&lt;tab&gt;&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">SetMark</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+&lt;space&gt;&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">KillRegion</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+w&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">UpperWord</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+u&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">LowerWord</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+l&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">CapitaliseWord</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+c&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">TransposeWord</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+t&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">TransposeChar</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+t&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">StringInsertRectangle</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">KillRectangle</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+x &lt;ctrl&gt;+r&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">YankRectangle</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+x &lt;ctrl&gt;+y&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">SearchForward</span><span class="p">,</span> <span class="s">&#39;&lt;ctrl&gt;+s&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">SearchForwardRegexp</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">QueryReplace</span><span class="p">,</span> <span class="s">&#39;&lt;alt&gt;+%&#39;</span><span class="p">),</span>
                  <span class="p">(</span><span class="n">QueryReplaceRegexp</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span>
                  <span class="p">)</span>

    <span class="c"># Iterate over the list of macros and their keybinding and</span>
    <span class="c"># register them if they are not already.</span>
    <span class="k">for</span> <span class="n">macroCls</span><span class="p">,</span> <span class="n">keysequence</span> <span class="ow">in</span> <span class="n">macro_list</span><span class="p">:</span>
        <span class="c"># Get the macro name.</span>
        <span class="n">macroName</span> <span class="o">=</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteMacroNameMangling</span><span class="p">(</span><span class="n">macroCls</span><span class="p">)</span>

        <span class="c"># Register the macro if it has not been already.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">qteMain</span><span class="o">.</span><span class="n">qteIsMacroRegistered</span><span class="p">(</span><span class="n">macroName</span><span class="p">,</span> <span class="n">widgetObj</span><span class="p">):</span>
            <span class="n">qteMain</span><span class="o">.</span><span class="n">qteRegisterMacro</span><span class="p">(</span><span class="n">macroCls</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="n">macroName</span><span class="p">)</span>

        <span class="c"># Assign the macro a keyboard shortcut if one is available.</span>
        <span class="k">if</span> <span class="n">keysequence</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">qteMain</span><span class="o">.</span><span class="n">qteBindKeyWidget</span><span class="p">(</span><span class="n">keysequence</span><span class="p">,</span> <span class="n">macroName</span><span class="p">,</span> <span class="n">widgetObj</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
        <p class="logo"><a href="../../../titlepage.html">
          <img class="logo" src="../../../_static/Max.png" alt="Logo"/>
        </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="relbar-bottom">
        
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> &nbsp; &nbsp;</li>
    <li><a href="../../../index.html">Qtmacs 0.1 documentation</a> &raquo;</li>

          <li><a href="../../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    </div>

    <div class="footer">
        &copy; Copyright 2012-2013, Oliver Nagy.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
    <!-- cloud_sptheme 1.4 -->
  </body>
</html>